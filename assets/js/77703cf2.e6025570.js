"use strict";(globalThis.webpackChunkmy_tutorial_site=globalThis.webpackChunkmy_tutorial_site||[]).push([[462],{1004:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>g,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"\u5176\u4ed6/cdp/intro1","title":"\ud83d\udfe0Debugger \u6559\u7a0b","description":"","source":"@site/docs/\u5176\u4ed6/cdp/1.debugger.md","sourceDirName":"\u5176\u4ed6/cdp","slug":"/\u5176\u4ed6/cdp/intro1","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro1","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"intro1","permalink":"/cdp/p1","title":"\ud83d\udfe0Debugger \u6559\u7a0b"},"sidebar":"otherSidebar","previous":{"title":"\ud83d\udfe0CDP\u7b80\u4ecb","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/p0"},"next":{"title":"\ud83d\udfe0Fetch \u6559\u7a0b","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro2"}}');var s=r(4848),a=r(8453);const i={id:"intro1",permalink:"/cdp/p1",title:"\ud83d\udfe0Debugger \u6559\u7a0b"},o="\ud83d\udfe0CDP Debugger \u5165\u95e8\u6559\u7a0b",g={},d=[];function u(e){const n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cdp-debugger-\u5165\u95e8\u6559\u7a0b",children:"\ud83d\udfe0CDP Debugger \u5165\u95e8\u6559\u7a0b"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'\nimport json\nimport websocket\nimport requests\nimport time\n\ndef get_websocket_url(port=9222):\n    """\u83b7\u53d6 WebSocket \u8c03\u8bd5 URL"""\n    response = requests.get(f\'http://localhost:{port}/json\')\n    tabs = response.json()\n    return tabs[0][\'webSocketDebuggerUrl\']\n\nclass CDPDebugger:\n    """CDP \u8c03\u8bd5\u5668\u5c01\u88c5\u7c7b"""\n    \n    def __init__(self, ws_url):\n        self.ws = websocket.create_connection(ws_url)\n        self.command_id = 0\n        \n    def send_command(self, method, params=None):\n        """\u53d1\u9001 CDP \u547d\u4ee4"""\n        self.command_id += 1\n        command = {\n            "id": self.command_id,\n            "method": method,\n            "params": params or {}\n        }\n        print(f"\\n>>> \u53d1\u9001\u547d\u4ee4: {method}")\n        print(f"    \u53c2\u6570: {json.dumps(params or {}, indent=6)}")\n        \n        self.ws.send(json.dumps(command))\n        response = json.loads(self.ws.recv())\n        \n        print(f"<<< \u54cd\u5e94: {json.dumps(response, indent=4, ensure_ascii=False)}")\n        return response\n    \n    def wait_for_event(self, event_name, timeout=5):\n        """\u7b49\u5f85\u7279\u5b9a\u4e8b\u4ef6"""\n        print(f"\\n--- \u7b49\u5f85\u4e8b\u4ef6: {event_name} ---")\n        start_time = time.time()\n        \n        while time.time() - start_time < timeout:\n            try:\n                self.ws.settimeout(1)\n                message = self.ws.recv()\n                data = json.loads(message)\n                \n                if \'method\' in data:\n                    print(f"    \u6536\u5230\u4e8b\u4ef6: {data[\'method\']}")\n                    if data[\'method\'] == event_name:\n                        print(f"    \u4e8b\u4ef6\u8be6\u60c5: {json.dumps(data[\'params\'], indent=8, ensure_ascii=False)}")\n                        return data\n            except:\n                continue\n        \n        print(f"    \u8d85\u65f6: \u672a\u6536\u5230 {event_name} \u4e8b\u4ef6")\n        return None\n    \n    def close(self):\n        self.ws.close()\n\n\n# ========================================\n# \u793a\u4f8b 1: \u57fa\u7840\u8c03\u8bd5\u6d41\u7a0b\n# ========================================\ndef example_basic_debugging():\n    """\n    \u6f14\u793a\u57fa\u7840\u8c03\u8bd5\u547d\u4ee4\u7ec4\u5408:\n    1. Debugger.enable - \u542f\u7528\u8c03\u8bd5\u5668\n    2. Runtime.enable - \u542f\u7528\u8fd0\u884c\u65f6\n    3. Page.enable - \u542f\u7528\u9875\u9762\u4e8b\u4ef6\n    4. Page.navigate - \u5bfc\u822a\u5230\u9875\u9762\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 1: \u57fa\u7840\u8c03\u8bd5\u6d41\u7a0b")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    # 1. \u542f\u7528\u8c03\u8bd5\u5668\n    debugger.send_command("Debugger.enable")\n    \n    # 2. \u542f\u7528\u8fd0\u884c\u65f6\uff08\u7528\u4e8e\u6267\u884c JavaScript\uff09\n    debugger.send_command("Runtime.enable")\n    \n    # 3. \u542f\u7528\u9875\u9762\u4e8b\u4ef6\n    debugger.send_command("Page.enable")\n    \n    # 4. \u5bfc\u822a\u5230\u9875\u9762\n    debugger.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    \n    # \u7b49\u5f85\u9875\u9762\u52a0\u8f7d\u4e8b\u4ef6\n    debugger.wait_for_event("Page.loadEventFired")\n    \n    debugger.close()\n\n\n# ========================================\n# \u793a\u4f8b 2: \u8bbe\u7f6e\u65ad\u70b9\u548c\u6682\u505c\n# ========================================\ndef example_breakpoints():\n    """\n    \u6f14\u793a\u65ad\u70b9\u76f8\u5173\u547d\u4ee4:\n    1. Debugger.setBreakpointByUrl - \u6309 URL \u8bbe\u7f6e\u65ad\u70b9\n    2. Debugger.pause - \u6682\u505c\u6267\u884c\n    3. Debugger.resume - \u6062\u590d\u6267\u884c\n    4. Debugger.stepOver - \u5355\u6b65\u8df3\u8fc7\n    5. Debugger.stepInto - \u5355\u6b65\u8fdb\u5165\n    6. Debugger.stepOut - \u5355\u6b65\u8df3\u51fa\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 2: \u65ad\u70b9\u548c\u5355\u6b65\u8c03\u8bd5")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    debugger.send_command("Debugger.enable")\n    debugger.send_command("Runtime.enable")\n    \n    # 1. \u6309 URL \u8bbe\u7f6e\u65ad\u70b9\n    debugger.send_command("Debugger.setBreakpointByUrl", {\n        "lineNumber": 10,\n        "url": "https://example.com/script.js",\n        "columnNumber": 0,\n        "condition": "x > 5"  # \u6761\u4ef6\u65ad\u70b9\n    })\n    \n    # 2. \u6682\u505c\u6240\u6709\u6267\u884c\n    debugger.send_command("Debugger.pause")\n    \n    # \u7b49\u5f85\u6682\u505c\u4e8b\u4ef6\n    paused_event = debugger.wait_for_event("Debugger.paused")\n    \n    if paused_event:\n        # 3. \u5355\u6b65\u8df3\u8fc7\n        debugger.send_command("Debugger.stepOver")\n        \n        # 4. \u5355\u6b65\u8fdb\u5165\u51fd\u6570\n        debugger.send_command("Debugger.stepInto")\n        \n        # 5. \u5355\u6b65\u8df3\u51fa\u51fd\u6570\n        debugger.send_command("Debugger.stepOut")\n        \n        # 6. \u6062\u590d\u6267\u884c\n        debugger.send_command("Debugger.resume")\n    \n    debugger.close()\n\n\n# ========================================\n# \u793a\u4f8b 3: \u6267\u884c JavaScript \u548c\u83b7\u53d6\u8c03\u7528\u6808\n# ========================================\ndef example_runtime_evaluation():\n    """\n    \u6f14\u793a\u8fd0\u884c\u65f6\u8bc4\u4f30\u547d\u4ee4:\n    1. Runtime.evaluate - \u6267\u884c JavaScript\n    2. Debugger.evaluateOnCallFrame - \u5728\u8c03\u7528\u5e27\u4e0a\u8bc4\u4f30\n    3. Runtime.getProperties - \u83b7\u53d6\u5bf9\u8c61\u5c5e\u6027\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 3: JavaScript \u6267\u884c\u548c\u8bc4\u4f30")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    debugger.send_command("Debugger.enable")\n    debugger.send_command("Runtime.enable")\n    \n    # 1. \u5728\u9875\u9762\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c JavaScript\n    result = debugger.send_command("Runtime.evaluate", {\n        "expression": "document.title",\n        "returnByValue": True\n    })\n    \n    # 2. \u6267\u884c\u66f4\u590d\u6742\u7684\u8868\u8fbe\u5f0f\n    debugger.send_command("Runtime.evaluate", {\n        "expression": """\n            (function() {\n                return {\n                    url: window.location.href,\n                    userAgent: navigator.userAgent,\n                    screenWidth: screen.width\n                };\n            })()\n        """,\n        "returnByValue": True\n    })\n    \n    # 3. \u83b7\u53d6\u5168\u5c40\u5bf9\u8c61\n    result = debugger.send_command("Runtime.evaluate", {\n        "expression": "window",\n        "returnByValue": False\n    })\n    \n    if \'result\' in result and \'result\' in result[\'result\']:\n        object_id = result[\'result\'][\'result\'].get(\'objectId\')\n        if object_id:\n            # 4. \u83b7\u53d6\u5bf9\u8c61\u7684\u5c5e\u6027\n            debugger.send_command("Runtime.getProperties", {\n                "objectId": object_id,\n                "ownProperties": True\n            })\n    \n    debugger.close()\n\n\n# ========================================\n# \u793a\u4f8b 4: \u811a\u672c\u7ba1\u7406\n# ========================================\ndef example_script_management():\n    """\n    \u6f14\u793a\u811a\u672c\u76f8\u5173\u547d\u4ee4:\n    1. Debugger.getScriptSource - \u83b7\u53d6\u811a\u672c\u6e90\u4ee3\u7801\n    2. Debugger.setScriptSource - \u70ed\u66f4\u65b0\u811a\u672c\uff08\u5b9e\u9a8c\u6027\uff09\n    3. Debugger.searchInContent - \u5728\u811a\u672c\u4e2d\u641c\u7d22\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 4: \u811a\u672c\u7ba1\u7406")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    debugger.send_command("Debugger.enable")\n    \n    # \u7b49\u5f85\u811a\u672c\u89e3\u6790\u4e8b\u4ef6\n    script_event = debugger.wait_for_event("Debugger.scriptParsed", timeout=3)\n    \n    if script_event and \'params\' in script_event:\n        script_id = script_event[\'params\'].get(\'scriptId\')\n        \n        if script_id:\n            # 1. \u83b7\u53d6\u811a\u672c\u6e90\u4ee3\u7801\n            debugger.send_command("Debugger.getScriptSource", {\n                "scriptId": script_id\n            })\n            \n            # 2. \u5728\u811a\u672c\u4e2d\u641c\u7d22\n            debugger.send_command("Debugger.searchInContent", {\n                "scriptId": script_id,\n                "query": "function",\n                "caseSensitive": False,\n                "isRegex": False\n            })\n    \n    debugger.close()\n\n\n# ========================================\n# \u793a\u4f8b 5: \u5f02\u5e38\u5904\u7406\n# ========================================\ndef example_exception_handling():\n    """\n    \u6f14\u793a\u5f02\u5e38\u5904\u7406\u547d\u4ee4:\n    1. Debugger.setPauseOnExceptions - \u8bbe\u7f6e\u5f02\u5e38\u65f6\u6682\u505c\n    2. Debugger.setAsyncCallStackDepth - \u8bbe\u7f6e\u5f02\u6b65\u8c03\u7528\u6808\u6df1\u5ea6\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 5: \u5f02\u5e38\u5904\u7406")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    debugger.send_command("Debugger.enable")\n    debugger.send_command("Runtime.enable")\n    \n    # 1. \u8bbe\u7f6e\u5728\u6240\u6709\u5f02\u5e38\u65f6\u6682\u505c\n    debugger.send_command("Debugger.setPauseOnExceptions", {\n        "state": "all"  # \u53ef\u9009\u503c: "none", "uncaught", "all"\n    })\n    \n    # 2. \u8bbe\u7f6e\u5f02\u6b65\u8c03\u7528\u6808\u6df1\u5ea6\n    debugger.send_command("Debugger.setAsyncCallStackDepth", {\n        "maxDepth": 32\n    })\n    \n    # 3. \u6267\u884c\u4f1a\u629b\u51fa\u5f02\u5e38\u7684\u4ee3\u7801\n    debugger.send_command("Runtime.evaluate", {\n        "expression": "throw new Error(\'\u6d4b\u8bd5\u5f02\u5e38\')",\n        "returnByValue": True\n    })\n    \n    # \u7b49\u5f85\u5f02\u5e38\u6682\u505c\n    debugger.wait_for_event("Debugger.paused")\n    \n    debugger.close()\n\n\n# ========================================\n# \u793a\u4f8b 6: \u7efc\u5408\u5e94\u7528 - \u6027\u80fd\u5206\u6790\n# ========================================\ndef example_performance_profiling():\n    """\n    \u6f14\u793a\u6027\u80fd\u5206\u6790\u7ec4\u5408:\n    1. Profiler.enable - \u542f\u7528\u6027\u80fd\u5206\u6790\u5668\n    2. Profiler.start - \u5f00\u59cb\u8bb0\u5f55\n    3. Profiler.stop - \u505c\u6b62\u8bb0\u5f55\n    4. Coverage.enable - \u542f\u7528\u4ee3\u7801\u8986\u76d6\u7387\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 6: \u6027\u80fd\u5206\u6790")\n    print("="*60)\n    \n    debugger = CDPDebugger(get_websocket_url())\n    \n    debugger.send_command("Debugger.enable")\n    debugger.send_command("Profiler.enable")\n    \n    # 1. \u5f00\u59cb\u6027\u80fd\u5206\u6790\n    debugger.send_command("Profiler.start")\n    \n    # 2. \u6267\u884c\u4e00\u4e9b\u4ee3\u7801\n    debugger.send_command("Runtime.evaluate", {\n        "expression": """\n            for(let i = 0; i < 1000000; i++) {\n                Math.sqrt(i);\n            }\n        """\n    })\n    \n    # 3. \u505c\u6b62\u6027\u80fd\u5206\u6790\u5e76\u83b7\u53d6\u7ed3\u679c\n    profile = debugger.send_command("Profiler.stop")\n    \n    # 4. \u542f\u7528\u4ee3\u7801\u8986\u76d6\u7387\n    debugger.send_command("Profiler.startPreciseCoverage", {\n        "callCount": True,\n        "detailed": True\n    })\n    \n    time.sleep(2)\n    \n    # 5. \u83b7\u53d6\u8986\u76d6\u7387\u6570\u636e\n    debugger.send_command("Profiler.takePreciseCoverage")\n    \n    debugger.close()\n\n\n# ========================================\n# \u4e3b\u51fd\u6570 - \u8fd0\u884c\u6240\u6709\u793a\u4f8b\n# ========================================\nif __name__ == "__main__":\n    print("\\n" + "="*60)\n    print("CDP Debugger \u5e38\u7528\u547d\u4ee4\u793a\u4f8b\u96c6")\n    print("="*60)\n    print("\\n\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8:")\n    print("chrome --remote-debugging-port=9222 --user-data-dir=/tmp/chrome-debug")\n    print("\\n")\n    \n    try:\n        # \u8fd0\u884c\u6240\u6709\u793a\u4f8b\n        example_basic_debugging()\n        time.sleep(1)\n        \n        example_breakpoints()\n        time.sleep(1)\n        \n        example_runtime_evaluation()\n        time.sleep(1)\n        \n        example_script_management()\n        time.sleep(1)\n        \n        example_exception_handling()\n        time.sleep(1)\n        \n        example_performance_profiling()\n        \n        print("\\n" + "="*60)\n        print("\u6240\u6709\u793a\u4f8b\u6267\u884c\u5b8c\u6210\uff01")\n        print("="*60)\n        \n    except requests.exceptions.ConnectionError:\n        print("\\n\u274c \u9519\u8bef: \u65e0\u6cd5\u8fde\u63a5\u5230 Chrome")\n        print("\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528 --remote-debugging-port=9222 \u542f\u52a8")\n    except Exception as e:\n        print(f"\\n\u274c \u53d1\u751f\u9519\u8bef: {e}")\n        import traceback\n        traceback.print_exc()\n\n\n'})})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var t=r(6540);const s={},a=t.createContext(s);function i(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);