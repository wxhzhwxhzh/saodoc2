"use strict";(globalThis.webpackChunkmy_tutorial_site=globalThis.webpackChunkmy_tutorial_site||[]).push([[790],{8335:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"\u5176\u4ed6/cdp/intro2","title":"\ud83d\udfe0Fetch \u6559\u7a0b","description":"","source":"@site/docs/\u5176\u4ed6/cdp/2.fetch.md","sourceDirName":"\u5176\u4ed6/cdp","slug":"/\u5176\u4ed6/cdp/intro2","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro2","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"intro2","permalink":"/cdp/p2","title":"\ud83d\udfe0Fetch \u6559\u7a0b"},"sidebar":"otherSidebar","previous":{"title":"\ud83d\udfe0Debugger \u6559\u7a0b","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro1"},"next":{"title":"\ud83d\udfe0Page \u6559\u7a0b","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro3"}}');var r=t(4848),a=t(8453);const o={id:"intro2",permalink:"/cdp/p2",title:"\ud83d\udfe0Fetch \u6559\u7a0b"},d="\ud83d\udfe0Fetch \u6559\u7a0b",c={},i=[];function p(e){const n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"fetch-\u6559\u7a0b",children:"\ud83d\udfe0Fetch \u6559\u7a0b"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import json\nimport websocket\nimport requests\nimport time\nimport base64\nimport threading\n\ndef get_websocket_url(port=9222):\n    """\u83b7\u53d6 WebSocket \u8c03\u8bd5 URL"""\n    response = requests.get(f\'http://localhost:{port}/json\')\n    tabs = response.json()\n    return tabs[0][\'webSocketDebuggerUrl\']\n\nclass CDPFetch:\n    """CDP Fetch \u5c01\u88c5\u7c7b"""\n    \n    def __init__(self, ws_url):\n        self.ws = websocket.create_connection(ws_url)\n        self.command_id = 0\n        self.event_handlers = {}\n        self.running = True\n        \n        # \u542f\u52a8\u4e8b\u4ef6\u76d1\u542c\u7ebf\u7a0b\n        self.event_thread = threading.Thread(target=self._event_listener, daemon=True)\n        self.event_thread.start()\n        \n    def send_command(self, method, params=None):\n        """\u53d1\u9001 CDP \u547d\u4ee4"""\n        self.command_id += 1\n        command = {\n            "id": self.command_id,\n            "method": method,\n            "params": params or {}\n        }\n        print(f"\\n>>> \u53d1\u9001\u547d\u4ee4: {method}")\n        if params:\n            print(f"    \u53c2\u6570: {json.dumps(params, indent=6, ensure_ascii=False)}")\n        \n        self.ws.send(json.dumps(command))\n        \n        # \u7b49\u5f85\u54cd\u5e94\n        while True:\n            response = json.loads(self.ws.recv())\n            if \'id\' in response and response[\'id\'] == self.command_id:\n                print(f"<<< \u54cd\u5e94: {json.dumps(response, indent=4, ensure_ascii=False)}")\n                return response\n            elif \'method\' in response:\n                # \u8fd9\u662f\u4e8b\u4ef6\uff0c\u4ea4\u7ed9\u4e8b\u4ef6\u5904\u7406\u5668\n                self._handle_event(response)\n    \n    def _event_listener(self):\n        """\u540e\u53f0\u76d1\u542c\u4e8b\u4ef6"""\n        while self.running:\n            try:\n                self.ws.settimeout(0.1)\n                message = self.ws.recv()\n                data = json.loads(message)\n                if \'method\' in data:\n                    self._handle_event(data)\n            except:\n                continue\n    \n    def _handle_event(self, event):\n        """\u5904\u7406\u4e8b\u4ef6"""\n        method = event[\'method\']\n        if method in self.event_handlers:\n            self.event_handlers[method](event)\n    \n    def on_event(self, event_name, handler):\n        """\u6ce8\u518c\u4e8b\u4ef6\u5904\u7406\u5668"""\n        self.event_handlers[event_name] = handler\n    \n    def close(self):\n        self.running = False\n        time.sleep(0.2)\n        self.ws.close()\n\n\n# ========================================\n# \u793a\u4f8b 1: \u57fa\u7840\u8bf7\u6c42\u62e6\u622a\n# ========================================\ndef example_basic_fetch():\n    """\n    \u6f14\u793a\u57fa\u7840 Fetch \u529f\u80fd:\n    1. Fetch.enable - \u542f\u7528\u8bf7\u6c42\u62e6\u622a\n    2. \u76d1\u542c Fetch.requestPaused \u4e8b\u4ef6\n    3. Fetch.continueRequest - \u7ee7\u7eed\u8bf7\u6c42\n    4. Fetch.fulfillRequest - \u6a21\u62df\u54cd\u5e94\n    5. Fetch.failRequest - \u963b\u6b62\u8bf7\u6c42\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 1: \u57fa\u7840\u8bf7\u6c42\u62e6\u622a")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    # \u8bf7\u6c42\u8ba1\u6570\u5668\n    request_count = [0]\n    \n    def handle_request_paused(event):\n        """\u5904\u7406\u8bf7\u6c42\u6682\u505c\u4e8b\u4ef6"""\n        request_count[0] += 1\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        request = params[\'request\']\n        \n        print(f"\\n\ud83d\udd35 \u8bf7\u6c42\u88ab\u62e6\u622a #{request_count[0]}:")\n        print(f"    URL: {request[\'url\']}")\n        print(f"    \u65b9\u6cd5: {request[\'method\']}")\n        print(f"    \u8bf7\u6c42ID: {request_id}")\n        \n        # \u7ee7\u7eed\u8bf7\u6c42\uff08\u4e0d\u4fee\u6539\uff09\n        fetcher.send_command("Fetch.continueRequest", {\n            "requestId": request_id\n        })\n    \n    # \u6ce8\u518c\u4e8b\u4ef6\u5904\u7406\u5668\n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # 1. \u542f\u7528 Fetch\uff0c\u62e6\u622a\u6240\u6709\u8bf7\u6c42\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [\n            {\n                "urlPattern": "*",  # \u62e6\u622a\u6240\u6709 URL\n                "requestStage": "Request"  # \u5728\u8bf7\u6c42\u9636\u6bb5\u62e6\u622a\n            }\n        ]\n    })\n    \n    # 2. \u5bfc\u822a\u5230\u9875\u9762\u89e6\u53d1\u8bf7\u6c42\n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    \n    # \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\u8ba9\u8bf7\u6c42\u5b8c\u6210\n    time.sleep(3)\n    \n    print(f"\\n\u2705 \u603b\u5171\u62e6\u622a\u4e86 {request_count[0]} \u4e2a\u8bf7\u6c42")\n    \n    fetcher.close()\n\n\n# ========================================\n# \u793a\u4f8b 2: \u4fee\u6539\u8bf7\u6c42\n# ========================================\ndef example_modify_request():\n    """\n    \u6f14\u793a\u4fee\u6539\u8bf7\u6c42:\n    1. \u4fee\u6539\u8bf7\u6c42\u5934\n    2. \u4fee\u6539\u8bf7\u6c42\u65b9\u6cd5\n    3. \u4fee\u6539 POST \u6570\u636e\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 2: \u4fee\u6539\u8bf7\u6c42")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    def handle_request_paused(event):\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        request = params[\'request\']\n        \n        print(f"\\n\ud83d\udd35 \u62e6\u622a\u5230\u8bf7\u6c42: {request[\'url\']}")\n        \n        # \u4fee\u6539\u8bf7\u6c42\u5934\n        modified_headers = request.get(\'headers\', {}).copy()\n        modified_headers[\'X-Custom-Header\'] = \'Modified by CDP\'\n        modified_headers[\'User-Agent\'] = \'Custom CDP Bot/1.0\'\n        \n        print(f"    \u270f\ufe0f \u6dfb\u52a0\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934")\n        \n        # \u7ee7\u7eed\u8bf7\u6c42\u5e76\u5e94\u7528\u4fee\u6539\n        fetcher.send_command("Fetch.continueRequest", {\n            "requestId": request_id,\n            "headers": [\n                {"name": k, "value": v} \n                for k, v in modified_headers.items()\n            ]\n        })\n    \n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # \u542f\u7528 Fetch\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [{\n            "urlPattern": "*",\n            "requestStage": "Request"\n        }]\n    })\n    \n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Page.navigate", {\n        "url": "https://httpbin.org/headers"\n    })\n    \n    time.sleep(3)\n    fetcher.close()\n\n\n# ========================================\n# \u793a\u4f8b 3: \u6a21\u62df\u54cd\u5e94\uff08Mock Response\uff09\n# ========================================\ndef example_mock_response():\n    """\n    \u6f14\u793a\u6a21\u62df\u54cd\u5e94:\n    1. \u62e6\u622a\u7279\u5b9a URL\n    2. \u8fd4\u56de\u81ea\u5b9a\u4e49\u54cd\u5e94\u5185\u5bb9\n    3. \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\u548c\u72b6\u6001\u7801\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 3: \u6a21\u62df\u54cd\u5e94")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    def handle_request_paused(event):\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        request = params[\'request\']\n        url = request[\'url\']\n        \n        print(f"\\n\ud83d\udd35 \u62e6\u622a\u5230\u8bf7\u6c42: {url}")\n        \n        # \u5982\u679c\u662f API \u8bf7\u6c42\uff0c\u8fd4\u56de\u6a21\u62df\u6570\u636e\n        if \'api\' in url or \'json\' in url:\n            print(f"    \ud83c\udfad \u8fd4\u56de\u6a21\u62df\u54cd\u5e94")\n            \n            # \u81ea\u5b9a\u4e49\u54cd\u5e94\u4f53\n            mock_data = {\n                "status": "success",\n                "message": "This is a mocked response from CDP",\n                "data": {\n                    "id": 123,\n                    "name": "Mock User",\n                    "timestamp": time.time()\n                }\n            }\n            \n            response_body = json.dumps(mock_data)\n            encoded_body = base64.b64encode(response_body.encode()).decode()\n            \n            # \u8fd4\u56de\u6a21\u62df\u54cd\u5e94\n            fetcher.send_command("Fetch.fulfillRequest", {\n                "requestId": request_id,\n                "responseCode": 200,\n                "responseHeaders": [\n                    {"name": "Content-Type", "value": "application/json"},\n                    {"name": "X-Mocked-By", "value": "CDP"},\n                    {"name": "Access-Control-Allow-Origin", "value": "*"}\n                ],\n                "body": encoded_body\n            })\n        else:\n            # \u5176\u4ed6\u8bf7\u6c42\u6b63\u5e38\u7ee7\u7eed\n            fetcher.send_command("Fetch.continueRequest", {\n                "requestId": request_id\n            })\n    \n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # \u542f\u7528 Fetch\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [{\n            "urlPattern": "*",\n            "requestStage": "Request"\n        }]\n    })\n    \n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Runtime.enable")\n    \n    # \u5bfc\u822a\u5e76\u6267\u884c API \u8bf7\u6c42\n    fetcher.send_command("Page.navigate", {"url": "https://example.com"})\n    time.sleep(2)\n    \n    # \u6267\u884c fetch \u8bf7\u6c42\n    fetcher.send_command("Runtime.evaluate", {\n        "expression": """\n            fetch(\'https://api.example.com/users\')\n                .then(r => r.json())\n                .then(data => console.log(\'Response:\', data))\n        """\n    })\n    \n    time.sleep(2)\n    fetcher.close()\n\n\n# ========================================\n# \u793a\u4f8b 4: \u963b\u6b62\u7279\u5b9a\u8bf7\u6c42\n# ========================================\ndef example_block_requests():\n    """\n    \u6f14\u793a\u963b\u6b62\u8bf7\u6c42:\n    1. \u963b\u6b62\u5e7f\u544a\n    2. \u963b\u6b62\u8ffd\u8e2a\u811a\u672c\n    3. \u963b\u6b62\u56fe\u7247\u52a0\u8f7d\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 4: \u963b\u6b62\u7279\u5b9a\u8bf7\u6c42")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    # \u9ed1\u540d\u5355\u6a21\u5f0f\n    blocked_patterns = [\n        \'ads\',\n        \'analytics\',\n        \'tracking\',\n        \'doubleclick\',\n        \'googletagmanager\'\n    ]\n    \n    blocked_count = [0]\n    allowed_count = [0]\n    \n    def handle_request_paused(event):\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        request = params[\'request\']\n        url = request[\'url\'].lower()\n        \n        # \u68c0\u67e5\u662f\u5426\u5e94\u8be5\u963b\u6b62\n        should_block = any(pattern in url for pattern in blocked_patterns)\n        \n        if should_block:\n            blocked_count[0] += 1\n            print(f"\\n\ud83d\udeab \u963b\u6b62\u8bf7\u6c42 #{blocked_count[0]}: {request[\'url\'][:80]}")\n            \n            # \u963b\u6b62\u8bf7\u6c42\n            fetcher.send_command("Fetch.failRequest", {\n                "requestId": request_id,\n                "errorReason": "BlockedByClient"\n            })\n        else:\n            allowed_count[0] += 1\n            print(f"\\n\u2705 \u5141\u8bb8\u8bf7\u6c42 #{allowed_count[0]}: {request[\'url\'][:80]}")\n            \n            # \u7ee7\u7eed\u8bf7\u6c42\n            fetcher.send_command("Fetch.continueRequest", {\n                "requestId": request_id\n            })\n    \n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # \u542f\u7528 Fetch\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [{\n            "urlPattern": "*",\n            "requestStage": "Request"\n        }]\n    })\n    \n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Page.navigate", {\n        "url": "https://www.nytimes.com"  # \u901a\u5e38\u5305\u542b\u5e7f\u544a\u548c\u8ffd\u8e2a\n    })\n    \n    time.sleep(5)\n    \n    print(f"\\n" + "="*60)\n    print(f"\ud83d\udcca \u7edf\u8ba1:")\n    print(f"    \u963b\u6b62: {blocked_count[0]} \u4e2a\u8bf7\u6c42")\n    print(f"    \u5141\u8bb8: {allowed_count[0]} \u4e2a\u8bf7\u6c42")\n    print("="*60)\n    \n    fetcher.close()\n\n\n# ========================================\n# \u793a\u4f8b 5: \u62e6\u622a\u54cd\u5e94\uff08Response Stage\uff09\n# ========================================\ndef example_intercept_response():\n    """\n    \u6f14\u793a\u62e6\u622a\u54cd\u5e94:\n    1. \u5728\u54cd\u5e94\u9636\u6bb5\u62e6\u622a\n    2. Fetch.getResponseBody - \u83b7\u53d6\u54cd\u5e94\u4f53\n    3. \u4fee\u6539\u54cd\u5e94\u5185\u5bb9\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 5: \u62e6\u622a\u548c\u4fee\u6539\u54cd\u5e94")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    def handle_request_paused(event):\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        \n        # \u68c0\u67e5\u662f\u5426\u662f\u54cd\u5e94\u9636\u6bb5\n        if \'responseStatusCode\' in params:\n            print(f"\\n\ud83d\udd35 \u62e6\u622a\u5230\u54cd\u5e94:")\n            print(f"    \u72b6\u6001\u7801: {params[\'responseStatusCode\']}")\n            print(f"    URL: {params[\'request\'][\'url\'][:80]}")\n            \n            # \u83b7\u53d6\u539f\u59cb\u54cd\u5e94\u4f53\n            try:\n                response = fetcher.send_command("Fetch.getResponseBody", {\n                    "requestId": request_id\n                })\n                \n                if \'result\' in response and \'body\' in response[\'result\']:\n                    original_body = response[\'result\'][\'body\']\n                    \n                    # \u5982\u679c\u662f base64 \u7f16\u7801\n                    if response[\'result\'].get(\'base64Encoded\'):\n                        original_body = base64.b64decode(original_body).decode(\'utf-8\')\n                    \n                    print(f"    \u539f\u59cb\u54cd\u5e94\u5927\u5c0f: {len(original_body)} \u5b57\u8282")\n                    \n                    # \u4fee\u6539\u54cd\u5e94\u5185\u5bb9\n                    modified_body = original_body.replace(\n                        \'</body>\',\n                        \'<script>console.log("Injected by CDP!");<\/script></body>\'\n                    )\n                    \n                    encoded_body = base64.b64encode(modified_body.encode()).decode()\n                    \n                    # \u8fd4\u56de\u4fee\u6539\u540e\u7684\u54cd\u5e94\n                    fetcher.send_command("Fetch.fulfillRequest", {\n                        "requestId": request_id,\n                        "responseCode": params[\'responseStatusCode\'],\n                        "responseHeaders": params.get(\'responseHeaders\', []),\n                        "body": encoded_body\n                    })\n                    \n                    print(f"    \u270f\ufe0f \u5df2\u6ce8\u5165\u81ea\u5b9a\u4e49\u811a\u672c")\n                    return\n            except Exception as e:\n                print(f"    \u26a0\ufe0f \u65e0\u6cd5\u83b7\u53d6\u54cd\u5e94\u4f53: {e}")\n        \n        # \u9ed8\u8ba4\u7ee7\u7eed\n        fetcher.send_command("Fetch.continueRequest", {\n            "requestId": request_id\n        })\n    \n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # \u542f\u7528 Fetch\uff0c\u5728\u54cd\u5e94\u9636\u6bb5\u62e6\u622a HTML\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [{\n            "urlPattern": "*",\n            "resourceType": "Document",  # \u53ea\u62e6\u622a HTML \u6587\u6863\n            "requestStage": "Response"   # \u5728\u54cd\u5e94\u9636\u6bb5\u62e6\u622a\n        }]\n    })\n    \n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    \n    time.sleep(3)\n    fetcher.close()\n\n\n# ========================================\n# \u793a\u4f8b 6: \u7efc\u5408\u5e94\u7528 - HTTP \u4ee3\u7406\u529f\u80fd\n# ========================================\ndef example_http_proxy():\n    """\n    \u7efc\u5408\u793a\u4f8b: \u5b9e\u73b0\u7c7b\u4f3c HTTP \u4ee3\u7406\u7684\u529f\u80fd\n    1. \u8bb0\u5f55\u6240\u6709\u8bf7\u6c42/\u54cd\u5e94\n    2. \u4fee\u6539\u7279\u5b9a\u8bf7\u6c42\n    3. \u7f13\u5b58\u54cd\u5e94\n    4. \u7edf\u8ba1\u5206\u6790\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 6: HTTP \u4ee3\u7406\u529f\u80fd")\n    print("="*60)\n    \n    fetcher = CDPFetch(get_websocket_url())\n    \n    # \u7edf\u8ba1\u6570\u636e\n    stats = {\n        "total_requests": 0,\n        "blocked": 0,\n        "modified": 0,\n        "cached": 0,\n        "by_type": {}\n    }\n    \n    # \u7b80\u5355\u7684\u54cd\u5e94\u7f13\u5b58\n    response_cache = {}\n    \n    def handle_request_paused(event):\n        params = event[\'params\']\n        request_id = params[\'requestId\']\n        request = params[\'request\']\n        url = request[\'url\']\n        resource_type = params.get(\'resourceType\', \'Other\')\n        \n        stats["total_requests"] += 1\n        stats["by_type"][resource_type] = stats["by_type"].get(resource_type, 0) + 1\n        \n        print(f"\\n\ud83d\udce6 \u8bf7\u6c42 #{stats[\'total_requests\']}")\n        print(f"    \u7c7b\u578b: {resource_type}")\n        print(f"    URL: {url[:100]}")\n        \n        # \u68c0\u67e5\u7f13\u5b58\n        if url in response_cache:\n            stats["cached"] += 1\n            print(f"    \ud83d\udcbe \u4f7f\u7528\u7f13\u5b58")\n            \n            cached = response_cache[url]\n            fetcher.send_command("Fetch.fulfillRequest", cached)\n            return\n        \n        # \u963b\u6b62\u56fe\u7247\u8bf7\u6c42\uff08\u793a\u4f8b\uff09\n        if resource_type == "Image":\n            stats["blocked"] += 1\n            print(f"    \ud83d\udeab \u963b\u6b62\u56fe\u7247")\n            fetcher.send_command("Fetch.failRequest", {\n                "requestId": request_id,\n                "errorReason": "BlockedByClient"\n            })\n            return\n        \n        # \u4fee\u6539 JavaScript \u8bf7\u6c42\uff08\u793a\u4f8b\uff09\n        if resource_type == "Script":\n            stats["modified"] += 1\n            modified_headers = [\n                {"name": k, "value": v}\n                for k, v in request.get(\'headers\', {}).items()\n            ]\n            modified_headers.append(\n                {"name": "X-Script-Modified", "value": "true"}\n            )\n            \n            print(f"    \u270f\ufe0f \u4fee\u6539\u811a\u672c\u8bf7\u6c42\u5934")\n            fetcher.send_command("Fetch.continueRequest", {\n                "requestId": request_id,\n                "headers": modified_headers\n            })\n            return\n        \n        # \u5176\u4ed6\u8bf7\u6c42\u6b63\u5e38\u7ee7\u7eed\n        fetcher.send_command("Fetch.continueRequest", {\n            "requestId": request_id\n        })\n    \n    fetcher.on_event("Fetch.requestPaused", handle_request_paused)\n    \n    # \u542f\u7528\u5b8c\u6574\u7684\u8bf7\u6c42\u62e6\u622a\n    fetcher.send_command("Fetch.enable", {\n        "patterns": [{\n            "urlPattern": "*",\n            "requestStage": "Request"\n        }],\n        "handleAuthRequests": True\n    })\n    \n    fetcher.send_command("Page.enable")\n    fetcher.send_command("Page.navigate", {\n        "url": "https://news.ycombinator.com"\n    })\n    \n    time.sleep(5)\n    \n    # \u663e\u793a\u7edf\u8ba1\n    print("\\n" + "="*60)\n    print("\ud83d\udcca \u4ee3\u7406\u7edf\u8ba1:")\n    print(f"    \u603b\u8bf7\u6c42\u6570: {stats[\'total_requests\']}")\n    print(f"    \u5df2\u963b\u6b62: {stats[\'blocked\']}")\n    print(f"    \u5df2\u4fee\u6539: {stats[\'modified\']}")\n    print(f"    \u4f7f\u7528\u7f13\u5b58: {stats[\'cached\']}")\n    print(f"\\n\u6309\u7c7b\u578b\u5206\u7ec4:")\n    for res_type, count in sorted(stats[\'by_type\'].items(), key=lambda x: -x[1]):\n        print(f"    {res_type}: {count}")\n    print("="*60)\n    \n    fetcher.close()\n\n\n# ========================================\n# \u4e3b\u51fd\u6570\n# ========================================\nif __name__ == "__main__":\n    print("\\n" + "="*60)\n    print("CDP Fetch.enable \u5b8c\u6574\u793a\u4f8b\u96c6")\n    print("="*60)\n    print("\\n\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8:")\n    print("chrome --remote-debugging-port=9222 --user-data-dir=/tmp/chrome-debug")\n    print("\\n\u9009\u62e9\u8981\u8fd0\u884c\u7684\u793a\u4f8b:")\n    print("1. \u57fa\u7840\u8bf7\u6c42\u62e6\u622a")\n    print("2. \u4fee\u6539\u8bf7\u6c42")\n    print("3. \u6a21\u62df\u54cd\u5e94")\n    print("4. \u963b\u6b62\u7279\u5b9a\u8bf7\u6c42")\n    print("5. \u62e6\u622a\u548c\u4fee\u6539\u54cd\u5e94")\n    print("6. HTTP \u4ee3\u7406\u529f\u80fd")\n    print("0. \u8fd0\u884c\u6240\u6709\u793a\u4f8b")\n    \n    try:\n        choice = input("\\n\u8bf7\u8f93\u5165\u9009\u62e9 (0-6): ").strip()\n        \n        examples = {\n            "1": example_basic_fetch,\n            "2": example_modify_request,\n            "3": example_mock_response,\n            "4": example_block_requests,\n            "5": example_intercept_response,\n            "6": example_http_proxy\n        }\n        \n        if choice == "0":\n            for example in examples.values():\n                example()\n                time.sleep(2)\n        elif choice in examples:\n            examples[choice]()\n        else:\n            print("\u65e0\u6548\u9009\u62e9")\n        \n        print("\\n\u2705 \u793a\u4f8b\u6267\u884c\u5b8c\u6210\uff01")\n        \n    except requests.exceptions.ConnectionError:\n        print("\\n\u274c \u9519\u8bef: \u65e0\u6cd5\u8fde\u63a5\u5230 Chrome")\n        print("\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528 --remote-debugging-port=9222 \u542f\u52a8")\n    except KeyboardInterrupt:\n        print("\\n\\n\u26a0\ufe0f \u7528\u6237\u4e2d\u65ad")\n    except Exception as e:\n        print(f"\\n\u274c \u53d1\u751f\u9519\u8bef: {e}")\n        import traceback\n        traceback.print_exc()\n'})})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var s=t(6540);const r={},a=s.createContext(r);function o(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);