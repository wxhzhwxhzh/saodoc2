"use strict";(globalThis.webpackChunkmy_tutorial_site=globalThis.webpackChunkmy_tutorial_site||[]).push([[3420],{198:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>o});const d=JSON.parse('{"id":"\u5176\u4ed6/MySQL/6","title":"6.sqlite_utils\u8be6\u89e3","description":"sqlite_utils \u662f\u4e00\u4e2a\u5f3a\u5927\u7684 Python \u5e93,\u7528\u4e8e\u7b80\u5316 SQLite \u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002\u5b83\u63d0\u4f9b\u4e86\u6bd4\u6807\u51c6\u5e93 sqlite3 \u66f4\u7b80\u6d01\u3001\u66f4 Pythonic \u7684 API\u3002","source":"@site/docs/\u5176\u4ed6/MySQL/6.md","sourceDirName":"\u5176\u4ed6/MySQL","slug":"/\u5176\u4ed6/MySQL/6","permalink":"/saodoc2/docs/\u5176\u4ed6/MySQL/6","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"6","title":"6.sqlite_utils\u8be6\u89e3","sidebar_position":6},"sidebar":"otherSidebar","previous":{"title":"5.\u6027\u80fd\u4f18\u5316\u548c\u4e8b\u52a1","permalink":"/saodoc2/docs/\u5176\u4ed6/MySQL/5"},"next":{"title":"1.\u262f\u592a\u6781\u62f3\u5c0f\u5e8f","permalink":"/saodoc2/docs/\u5176\u4ed6/Other/1"}}');var i=s(4848),r=s(8453);const t={id:6,title:"6.sqlite_utils\u8be6\u89e3",sidebar_position:6},l="sqlite_utils \u8be6\u7ec6\u4f7f\u7528\u6307\u5357",a={},o=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u6838\u5fc3\u529f\u80fd",id:"\u6838\u5fc3\u529f\u80fd",level:2},{value:"1. \u57fa\u672c\u6570\u636e\u5e93\u64cd\u4f5c",id:"1-\u57fa\u672c\u6570\u636e\u5e93\u64cd\u4f5c",level:3},{value:"2. \u63d2\u5165\u6570\u636e",id:"2-\u63d2\u5165\u6570\u636e",level:3},{value:"3. \u67e5\u8be2\u6570\u636e",id:"3-\u67e5\u8be2\u6570\u636e",level:3},{value:"4. \u66f4\u65b0\u6570\u636e",id:"4-\u66f4\u65b0\u6570\u636e",level:3},{value:"5. \u5220\u9664\u6570\u636e",id:"5-\u5220\u9664\u6570\u636e",level:3},{value:"6. \u8868\u7ed3\u6784\u64cd\u4f5c",id:"6-\u8868\u7ed3\u6784\u64cd\u4f5c",level:3},{value:"7. \u4e3b\u952e\u548c\u7c7b\u578b\u5904\u7406",id:"7-\u4e3b\u952e\u548c\u7c7b\u578b\u5904\u7406",level:3},{value:"8. \u6279\u91cf\u64cd\u4f5c\u548c\u4e8b\u52a1",id:"8-\u6279\u91cf\u64cd\u4f5c\u548c\u4e8b\u52a1",level:3},{value:"9. \u6570\u636e\u8f6c\u6362",id:"9-\u6570\u636e\u8f6c\u6362",level:3},{value:"10. \u5168\u6587\u641c\u7d22",id:"10-\u5168\u6587\u641c\u7d22",level:3},{value:"11. \u5b9e\u7528\u65b9\u6cd5",id:"11-\u5b9e\u7528\u65b9\u6cd5",level:3},{value:"12. \u67e5\u627e\u548c\u66ff\u6362",id:"12-\u67e5\u627e\u548c\u66ff\u6362",level:3},{value:"13. \u9ad8\u7ea7\u67e5\u8be2",id:"13-\u9ad8\u7ea7\u67e5\u8be2",level:3},{value:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",id:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",level:2},{value:"\u547d\u4ee4\u884c\u5de5\u5177",id:"\u547d\u4ee4\u884c\u5de5\u5177",level:2},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"sqlite_utils-\u8be6\u7ec6\u4f7f\u7528\u6307\u5357",children:"sqlite_utils \u8be6\u7ec6\u4f7f\u7528\u6307\u5357"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sqlite_utils"})," \u662f\u4e00\u4e2a\u5f3a\u5927\u7684 Python \u5e93,\u7528\u4e8e\u7b80\u5316 SQLite \u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002\u5b83\u63d0\u4f9b\u4e86\u6bd4\u6807\u51c6\u5e93 ",(0,i.jsx)(n.code,{children:"sqlite3"})," \u66f4\u7b80\u6d01\u3001\u66f4 Pythonic \u7684 API\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pip install sqlite-utils\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6838\u5fc3\u529f\u80fd",children:"\u6838\u5fc3\u529f\u80fd"}),"\n",(0,i.jsx)(n.h3,{id:"1-\u57fa\u672c\u6570\u636e\u5e93\u64cd\u4f5c",children:"1. \u57fa\u672c\u6570\u636e\u5e93\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from sqlite_utils import Database\n\n# \u521b\u5efa/\u8fde\u63a5\u6570\u636e\u5e93\ndb = Database("my_database.db")\n\n# \u5185\u5b58\u6570\u636e\u5e93\ndb = Database(memory=True)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"2-\u63d2\u5165\u6570\u636e",children:"2. \u63d2\u5165\u6570\u636e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u63d2\u5165\u5355\u6761\u8bb0\u5f55\ndb["dogs"].insert({\n    "name": "Cleo",\n    "age": 4,\n    "breed": "Labrador"\n})\n\n# \u63d2\u5165\u591a\u6761\u8bb0\u5f55\ndb["dogs"].insert_all([\n    {"name": "Max", "age": 2, "breed": "Poodle"},\n    {"name": "Buddy", "age": 5, "breed": "Golden Retriever"}\n])\n\n# \u5982\u679c\u5b58\u5728\u5219\u66ff\u6362\ndb["dogs"].insert({"id": 1, "name": "Cleo", "age": 5}, replace=True)\n\n# \u5982\u679c\u5b58\u5728\u5219\u5ffd\u7565\ndb["dogs"].insert({"name": "Max"}, ignore=True)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"3-\u67e5\u8be2\u6570\u636e",children:"3. \u67e5\u8be2\u6570\u636e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u83b7\u53d6\u6240\u6709\u884c\nfor row in db["dogs"].rows:\n    print(row)\n\n# \u4f7f\u7528 SQL \u67e5\u8be2\nfor row in db.query("SELECT * FROM dogs WHERE age > ?", [3]):\n    print(row)\n\n# \u83b7\u53d6\u7279\u5b9a\u5217\nfor row in db["dogs"].rows_where(select="name, age"):\n    print(row)\n\n# \u5e26\u6761\u4ef6\u67e5\u8be2\nfor row in db["dogs"].rows_where("age > ?", [3]):\n    print(row)\n\n# \u83b7\u53d6\u5355\u6761\u8bb0\u5f55\ndog = db["dogs"].get(1)  # \u901a\u8fc7\u4e3b\u952e\n'})}),"\n",(0,i.jsx)(n.h3,{id:"4-\u66f4\u65b0\u6570\u636e",children:"4. \u66f4\u65b0\u6570\u636e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u66f4\u65b0\u8bb0\u5f55\ndb["dogs"].update(1, {"age": 5})\n\n# \u6279\u91cf\u66f4\u65b0\ndb["dogs"].update_where("breed = ?", ["Labrador"], {"age": 6})\n\n# upsert (\u66f4\u65b0\u6216\u63d2\u5165)\ndb["dogs"].upsert({"id": 1, "name": "Cleo", "age": 6}, pk="id")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"5-\u5220\u9664\u6570\u636e",children:"5. \u5220\u9664\u6570\u636e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u5220\u9664\u7279\u5b9a\u8bb0\u5f55\ndb["dogs"].delete(1)\n\n# \u6279\u91cf\u5220\u9664\ndb["dogs"].delete_where("age < ?", [2])\n\n# \u5220\u9664\u8868\ndb["dogs"].drop()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"6-\u8868\u7ed3\u6784\u64cd\u4f5c",children:"6. \u8868\u7ed3\u6784\u64cd\u4f5c"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u521b\u5efa\u8868\u5e76\u6307\u5b9a\u4e3b\u952e\ndb["users"].insert({"id": 1, "name": "Alice"}, pk="id")\n\n# \u6dfb\u52a0\u5217\ndb["dogs"].add_column("weight", float)\n\n# \u521b\u5efa\u7d22\u5f15\ndb["dogs"].create_index(["breed"])\n\n# \u521b\u5efa\u552f\u4e00\u7d22\u5f15\ndb["dogs"].create_index(["name"], unique=True)\n\n# \u6dfb\u52a0\u5916\u952e\ndb["walks"].add_foreign_key("dog_id", "dogs", "id")\n\n# \u67e5\u770b\u8868\u7ed3\u6784\nprint(db["dogs"].columns)\nprint(db["dogs"].schema)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"7-\u4e3b\u952e\u548c\u7c7b\u578b\u5904\u7406",children:"7. \u4e3b\u952e\u548c\u7c7b\u578b\u5904\u7406"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u6307\u5b9a\u4e3b\u952e\ndb["users"].insert({"username": "alice", "email": "alice@example.com"}, pk="username")\n\n# \u590d\u5408\u4e3b\u952e\ndb["scores"].insert({"user_id": 1, "game_id": 2, "score": 100}, pk=("user_id", "game_id"))\n\n# \u81ea\u52a8\u68c0\u6d4b\u7c7b\u578b\ndb["measurements"].insert({\n    "temperature": 23.5,\n    "humidity": 65,\n    "recorded_at": "2024-01-07"\n})\n'})}),"\n",(0,i.jsx)(n.h3,{id:"8-\u6279\u91cf\u64cd\u4f5c\u548c\u4e8b\u52a1",children:"8. \u6279\u91cf\u64cd\u4f5c\u548c\u4e8b\u52a1"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u6279\u91cf\u63d2\u5165\u66f4\u9ad8\u6548\nrows = [{"name": f"Dog{i}", "age": i} for i in range(1000)]\ndb["dogs"].insert_all(rows)\n\n# \u663e\u5f0f\u4e8b\u52a1\nwith db.conn:\n    db["dogs"].insert({"name": "Rex", "age": 3})\n    db["cats"].insert({"name": "Whiskers", "age": 2})\n'})}),"\n",(0,i.jsx)(n.h3,{id:"9-\u6570\u636e\u8f6c\u6362",children:"9. \u6570\u636e\u8f6c\u6362"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u4ece CSV \u5bfc\u5165\nimport csv\nwith open("data.csv") as f:\n    reader = csv.DictReader(f)\n    db["data"].insert_all(reader)\n\n# \u8f6c\u6362\u4e3a pandas DataFrame\nimport pandas as pd\ndf = pd.DataFrame(db["dogs"].rows)\n\n# \u4ece DataFrame \u5bfc\u5165\ndb["new_table"].insert_all(df.to_dict("records"))\n'})}),"\n",(0,i.jsx)(n.h3,{id:"10-\u5168\u6587\u641c\u7d22",children:"10. \u5168\u6587\u641c\u7d22"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u542f\u7528 FTS (Full-Text Search)\ndb["articles"].enable_fts(["title", "content"])\n\n# \u641c\u7d22\nfor row in db["articles"].search("python"):\n    print(row)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"11-\u5b9e\u7528\u65b9\u6cd5",children:"11. \u5b9e\u7528\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u5217\u51fa\u6240\u6709\u8868\nprint(db.table_names())\n\n# \u68c0\u67e5\u8868\u662f\u5426\u5b58\u5728\nif "dogs" in db.table_names():\n    print("Table exists")\n\n# \u83b7\u53d6\u884c\u6570\ncount = db["dogs"].count\n\n# \u83b7\u53d6\u8868\u4fe1\u606f\nprint(db["dogs"].count_where("age > ?", [3]))\n\n# \u6267\u884c\u539f\u59cb SQL\ndb.execute("CREATE INDEX idx_age ON dogs(age)")\n\n# \u771f\u7a7a\u6570\u636e\u5e93(\u538b\u7f29)\ndb.vacuum()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"12-\u67e5\u627e\u548c\u66ff\u6362",children:"12. \u67e5\u627e\u548c\u66ff\u6362"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u4f7f\u7528 lookup \u521b\u5efa\u67e5\u627e\u8868\nauthor_id = db["authors"].lookup({"name": "J.K. Rowling"})\n# \u5982\u679c\u4e0d\u5b58\u5728\u5219\u521b\u5efa,\u8fd4\u56de ID\n\ndb["books"].insert({\n    "title": "Harry Potter",\n    "author_id": author_id\n})\n'})}),"\n",(0,i.jsx)(n.h3,{id:"13-\u9ad8\u7ea7\u67e5\u8be2",children:"13. \u9ad8\u7ea7\u67e5\u8be2"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# \u4f7f\u7528 order_by\nfor row in db["dogs"].rows_where(order_by="age DESC"):\n    print(row)\n\n# \u9650\u5236\u7ed3\u679c\nfor row in db["dogs"].rows_where(limit=5, offset=10):\n    print(row)\n\n# \u5206\u7ec4\u7edf\u8ba1\nresult = db.execute("""\n    SELECT breed, COUNT(*) as count, AVG(age) as avg_age\n    FROM dogs\n    GROUP BY breed\n""").fetchall()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b",children:"\u5b9e\u9645\u5e94\u7528\u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from sqlite_utils import Database\n\n# \u521b\u5efa\u6570\u636e\u5e93\ndb = Database("blog.db")\n\n# \u63d2\u5165\u6587\u7ae0\ndb["posts"].insert_all([\n    {"title": "First Post", "content": "Hello World", "author": "Alice"},\n    {"title": "Second Post", "content": "Learning SQLite", "author": "Bob"}\n], pk="title")\n\n# \u521b\u5efa\u6807\u7b7e\u8868\ndb["tags"].insert_all([\n    {"post_title": "First Post", "tag": "introduction"},\n    {"post_title": "First Post", "tag": "hello"},\n    {"post_title": "Second Post", "tag": "tutorial"}\n])\n\n# \u521b\u5efa\u7d22\u5f15\u63d0\u9ad8\u67e5\u8be2\u6027\u80fd\ndb["posts"].create_index(["author"])\ndb["tags"].create_index(["tag"])\n\n# \u67e5\u8be2\nfor post in db["posts"].rows_where("author = ?", ["Alice"]):\n    print(f"Title: {post[\'title\']}")\n    \n# \u7edf\u8ba1\u6bcf\u4e2a\u4f5c\u8005\u7684\u6587\u7ae0\u6570\nstats = db.execute("""\n    SELECT author, COUNT(*) as post_count\n    FROM posts\n    GROUP BY author\n""").fetchall()\n\nprint(stats)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u547d\u4ee4\u884c\u5de5\u5177",children:"\u547d\u4ee4\u884c\u5de5\u5177"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sqlite-utils"})," \u8fd8\u63d0\u4f9b\u4e86\u547d\u4ee4\u884c\u5de5\u5177:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# \u63d2\u5165 JSON \u6570\u636e\necho \'{"name": "Cleo", "age": 4}\' | sqlite-utils insert dogs.db dogs -\n\n# \u67e5\u8be2\u5e76\u8f93\u51fa JSON\nsqlite-utils query dogs.db "SELECT * FROM dogs" --json\n\n# \u4ece CSV \u5bfc\u5165\nsqlite-utils insert dogs.db dogs data.csv --csv\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u603b\u7ed3",children:"\u603b\u7ed3"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"sqlite_utils"})," \u7684\u4e3b\u8981\u4f18\u52bf:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7b80\u6d01\u7684 API"}),": \u6bd4\u539f\u751f ",(0,i.jsx)(n.code,{children:"sqlite3"})," \u66f4\u6613\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u81ea\u52a8\u7c7b\u578b\u68c0\u6d4b"}),": \u65e0\u9700\u624b\u52a8\u5b9a\u4e49\u8868\u7ed3\u6784"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6279\u91cf\u64cd\u4f5c"}),": \u9ad8\u6548\u5904\u7406\u5927\u91cf\u6570\u636e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5b9e\u7528\u529f\u80fd"}),": FTS\u3001lookup\u3001upsert \u7b49"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u547d\u4ee4\u884c\u5de5\u5177"}),": \u5feb\u901f\u6570\u636e\u64cd\u4f5c"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u8fd9\u4e2a\u5e93\u7279\u522b\u9002\u5408\u6570\u636e\u5904\u7406\u3001ETL \u4efb\u52a1\u3001\u5feb\u901f\u539f\u578b\u5f00\u53d1\u7b49\u573a\u666f\u3002"})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var d=s(6540);const i={},r=d.createContext(i);function t(e){const n=d.useContext(r);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),d.createElement(r.Provider,{value:n},e.children)}}}]);