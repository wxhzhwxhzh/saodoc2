"use strict";(globalThis.webpackChunkmy_tutorial_site=globalThis.webpackChunkmy_tutorial_site||[]).push([[782],{8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>o});var a=t(6540);const r={},i=a.createContext(r);function s(n){const e=a.useContext(i);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),a.createElement(i.Provider,{value:e},n.children)}},8824:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>p,contentTitle:()=>o,default:()=>l,frontMatter:()=>s,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"\u5176\u4ed6/cdp/intro3","title":"\ud83d\udfe0Page \u6559\u7a0b","description":"","source":"@site/docs/\u5176\u4ed6/cdp/3.page.md","sourceDirName":"\u5176\u4ed6/cdp","slug":"/\u5176\u4ed6/cdp/intro3","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro3","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"intro3","permalink":"/cdp/p3","title":"\ud83d\udfe0Page \u6559\u7a0b"},"sidebar":"otherSidebar","previous":{"title":"\ud83d\udfe0Fetch \u6559\u7a0b","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro2"},"next":{"title":"\ud83d\udfe0Target","permalink":"/saodoc2/docs/\u5176\u4ed6/cdp/intro4"}}');var r=t(4848),i=t(8453);const s={id:"intro3",permalink:"/cdp/p3",title:"\ud83d\udfe0Page \u6559\u7a0b"},o="\ud83d\udfe0Page \u6559\u7a0b",p={},d=[];function m(n){const e={code:"code",h1:"h1",header:"header",pre:"pre",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"page-\u6559\u7a0b",children:"\ud83d\udfe0Page \u6559\u7a0b"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import json\nimport websocket\nimport requests\nimport time\nimport threading\nimport base64\nfrom datetime import datetime\n\ndef get_websocket_url(port=9222):\n    """\u83b7\u53d6 WebSocket \u8c03\u8bd5 URL"""\n    response = requests.get(f\'http://localhost:{port}/json\')\n    tabs = response.json()\n    return tabs[0][\'webSocketDebuggerUrl\']\n\nclass CDPPage:\n    """CDP Page \u5c01\u88c5\u7c7b"""\n    \n    def __init__(self, ws_url):\n        self.ws = websocket.create_connection(ws_url)\n        self.command_id = 0\n        self.event_handlers = {}\n        self.running = True\n        self.events_log = []\n        \n        # \u542f\u52a8\u4e8b\u4ef6\u76d1\u542c\u7ebf\u7a0b\n        self.event_thread = threading.Thread(target=self._event_listener, daemon=True)\n        self.event_thread.start()\n        \n    def send_command(self, method, params=None):\n        """\u53d1\u9001 CDP \u547d\u4ee4"""\n        self.command_id += 1\n        command = {\n            "id": self.command_id,\n            "method": method,\n            "params": params or {}\n        }\n        print(f"\\n>>> \u53d1\u9001\u547d\u4ee4: {method}")\n        if params:\n            print(f"    \u53c2\u6570: {json.dumps(params, indent=6, ensure_ascii=False)}")\n        \n        self.ws.send(json.dumps(command))\n        \n        # \u7b49\u5f85\u54cd\u5e94\n        while True:\n            response = json.loads(self.ws.recv())\n            if \'id\' in response and response[\'id\'] == self.command_id:\n                if \'error\' not in response:\n                    print(f"<<< \u54cd\u5e94\u6210\u529f")\n                    if \'result\' in response and response[\'result\']:\n                        print(f"    \u7ed3\u679c: {json.dumps(response[\'result\'], indent=6, ensure_ascii=False)[:200]}")\n                else:\n                    print(f"<<< \u9519\u8bef: {response[\'error\']}")\n                return response\n            elif \'method\' in response:\n                self._handle_event(response)\n    \n    def _event_listener(self):\n        """\u540e\u53f0\u76d1\u542c\u4e8b\u4ef6"""\n        while self.running:\n            try:\n                self.ws.settimeout(0.1)\n                message = self.ws.recv()\n                data = json.loads(message)\n                if \'method\' in data:\n                    self._handle_event(data)\n            except:\n                continue\n    \n    def _handle_event(self, event):\n        """\u5904\u7406\u4e8b\u4ef6"""\n        method = event[\'method\']\n        self.events_log.append({\n            \'timestamp\': datetime.now().isoformat(),\n            \'method\': method,\n            \'params\': event.get(\'params\', {})\n        })\n        \n        if method in self.event_handlers:\n            self.event_handlers[method](event)\n    \n    def on_event(self, event_name, handler):\n        """\u6ce8\u518c\u4e8b\u4ef6\u5904\u7406\u5668"""\n        self.event_handlers[event_name] = handler\n    \n    def wait_for_event(self, event_name, timeout=10):\n        """\u7b49\u5f85\u7279\u5b9a\u4e8b\u4ef6"""\n        start_time = time.time()\n        while time.time() - start_time < timeout:\n            for event in reversed(self.events_log):\n                if event[\'method\'] == event_name:\n                    return event\n            time.sleep(0.1)\n        return None\n    \n    def close(self):\n        self.running = False\n        time.sleep(0.2)\n        self.ws.close()\n\n\n# ========================================\n# \u793a\u4f8b 1: \u57fa\u7840\u9875\u9762\u751f\u547d\u5468\u671f\u76d1\u542c\n# ========================================\ndef example_page_lifecycle():\n    """\n    \u6f14\u793a\u9875\u9762\u751f\u547d\u5468\u671f\u4e8b\u4ef6:\n    1. Page.enable - \u542f\u7528\u9875\u9762\u4e8b\u4ef6\n    2. Page.lifecycleEvent - \u751f\u547d\u5468\u671f\u4e8b\u4ef6\n    3. Page.loadEventFired - \u9875\u9762\u52a0\u8f7d\u5b8c\u6210\n    4. Page.domContentEventFired - DOM \u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210\n    5. Page.frameStartedLoading - \u6846\u67b6\u5f00\u59cb\u52a0\u8f7d\n    6. Page.frameStoppedLoading - \u6846\u67b6\u505c\u6b62\u52a0\u8f7d\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 1: \u9875\u9762\u751f\u547d\u5468\u671f\u76d1\u542c")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    \n    lifecycle_events = []\n    \n    def handle_lifecycle(event):\n        params = event[\'params\']\n        lifecycle_events.append({\n            \'name\': params.get(\'name\'),\n            \'timestamp\': params.get(\'timestamp\'),\n            \'frameId\': params.get(\'frameId\', \'\')[:20]\n        })\n        print(f"\\n\ud83d\udd04 \u751f\u547d\u5468\u671f\u4e8b\u4ef6: {params.get(\'name\')}")\n        print(f"    \u65f6\u95f4\u6233: {params.get(\'timestamp\')}")\n    \n    def handle_load_event(event):\n        print(f"\\n\u2705 Page.loadEventFired - \u9875\u9762\u5b8c\u5168\u52a0\u8f7d")\n        print(f"    \u65f6\u95f4\u6233: {event[\'params\'].get(\'timestamp\')}")\n    \n    def handle_dom_content(event):\n        print(f"\\n\u2705 Page.domContentEventFired - DOM \u5185\u5bb9\u52a0\u8f7d\u5b8c\u6210")\n        print(f"    \u65f6\u95f4\u6233: {event[\'params\'].get(\'timestamp\')}")\n    \n    def handle_frame_started(event):\n        frame_id = event[\'params\'].get(\'frameId\', \'\')[:20]\n        print(f"\\n\ud83d\udd35 \u6846\u67b6\u5f00\u59cb\u52a0\u8f7d: {frame_id}...")\n    \n    def handle_frame_stopped(event):\n        frame_id = event[\'params\'].get(\'frameId\', \'\')[:20]\n        print(f"\\n\ud83d\udd35 \u6846\u67b6\u505c\u6b62\u52a0\u8f7d: {frame_id}...")\n    \n    # \u6ce8\u518c\u4e8b\u4ef6\u5904\u7406\u5668\n    page.on_event("Page.lifecycleEvent", handle_lifecycle)\n    page.on_event("Page.loadEventFired", handle_load_event)\n    page.on_event("Page.domContentEventFired", handle_dom_content)\n    page.on_event("Page.frameStartedLoading", handle_frame_started)\n    page.on_event("Page.frameStoppedLoading", handle_frame_stopped)\n    \n    # 1. \u542f\u7528\u9875\u9762\u4e8b\u4ef6\n    page.send_command("Page.enable")\n    \n    # 2. \u8bbe\u7f6e\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u76d1\u542c\n    page.send_command("Page.setLifecycleEventsEnabled", {\n        "enabled": True\n    })\n    \n    # 3. \u5bfc\u822a\u5230\u9875\u9762\n    page.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    \n    # \u7b49\u5f85\u9875\u9762\u52a0\u8f7d\n    time.sleep(5)\n    \n    # \u663e\u793a\u751f\u547d\u5468\u671f\u6458\u8981\n    print("\\n" + "="*60)\n    print("\ud83d\udcca \u751f\u547d\u5468\u671f\u4e8b\u4ef6\u6458\u8981:")\n    for i, event in enumerate(lifecycle_events, 1):\n        print(f"    {i}. {event[\'name\']}")\n    print("="*60)\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 2: \u9875\u9762\u5bfc\u822a\u63a7\u5236\n# ========================================\ndef example_page_navigation():\n    """\n    \u6f14\u793a\u9875\u9762\u5bfc\u822a\u547d\u4ee4:\n    1. Page.navigate - \u5bfc\u822a\u5230 URL\n    2. Page.reload - \u91cd\u8f7d\u9875\u9762\n    3. Page.stopLoading - \u505c\u6b62\u52a0\u8f7d\n    4. Page.navigateToHistoryEntry - \u5bfc\u822a\u5230\u5386\u53f2\u8bb0\u5f55\n    5. Page.getNavigationHistory - \u83b7\u53d6\u5bfc\u822a\u5386\u53f2\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 2: \u9875\u9762\u5bfc\u822a\u63a7\u5236")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    \n    def handle_navigation(event):\n        params = event[\'params\']\n        print(f"\\n\ud83d\udd04 \u9875\u9762\u5bfc\u822a")\n        print(f"    URL: {params.get(\'url\', \'N/A\')}")\n        print(f"    Frame ID: {params.get(\'frameId\', \'N/A\')[:20]}...")\n    \n    page.on_event("Page.frameNavigated", handle_navigation)\n    page.send_command("Page.enable")\n    \n    # 1. \u5bfc\u822a\u5230\u7b2c\u4e00\u4e2a\u9875\u9762\n    print("\\n--- \u5bfc\u822a\u5230 Example.com ---")\n    page.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    time.sleep(2)\n    \n    # 2. \u5bfc\u822a\u5230\u7b2c\u4e8c\u4e2a\u9875\u9762\n    print("\\n--- \u5bfc\u822a\u5230 Wikipedia ---")\n    page.send_command("Page.navigate", {\n        "url": "https://www.wikipedia.org"\n    })\n    time.sleep(2)\n    \n    # 3. \u83b7\u53d6\u5bfc\u822a\u5386\u53f2\n    print("\\n--- \u83b7\u53d6\u5bfc\u822a\u5386\u53f2 ---")\n    history = page.send_command("Page.getNavigationHistory")\n    if \'result\' in history:\n        entries = history[\'result\'].get(\'entries\', [])\n        current_index = history[\'result\'].get(\'currentIndex\', 0)\n        print(f"    \u5f53\u524d\u7d22\u5f15: {current_index}")\n        print(f"    \u5386\u53f2\u8bb0\u5f55\u6570: {len(entries)}")\n        for i, entry in enumerate(entries):\n            marker = " <- \u5f53\u524d" if i == current_index else ""\n            print(f"    {i}. {entry.get(\'url\', \'N/A\')[:60]}{marker}")\n    \n    # 4. \u8fd4\u56de\u4e0a\u4e00\u9875\n    if \'result\' in history and history[\'result\'].get(\'currentIndex\', 0) > 0:\n        print("\\n--- \u8fd4\u56de\u4e0a\u4e00\u9875 ---")\n        prev_index = history[\'result\'][\'currentIndex\'] - 1\n        prev_entry_id = history[\'result\'][\'entries\'][prev_index][\'id\']\n        page.send_command("Page.navigateToHistoryEntry", {\n            "entryId": prev_entry_id\n        })\n        time.sleep(2)\n    \n    # 5. \u91cd\u8f7d\u9875\u9762\n    print("\\n--- \u91cd\u8f7d\u9875\u9762 ---")\n    page.send_command("Page.reload", {\n        "ignoreCache": True  # \u5ffd\u7565\u7f13\u5b58\n    })\n    time.sleep(2)\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 3: \u622a\u56fe\u548c PDF \u751f\u6210\n# ========================================\ndef example_capture_screenshot():\n    """\n    \u6f14\u793a\u9875\u9762\u6355\u83b7\u547d\u4ee4:\n    1. Page.captureScreenshot - \u622a\u56fe\n    2. Page.printToPDF - \u751f\u6210 PDF\n    3. Page.captureSnapshot - \u6355\u83b7 MHTML\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 3: \u622a\u56fe\u548c PDF \u751f\u6210")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    page.send_command("Page.enable")\n    \n    # \u5bfc\u822a\u5230\u9875\u9762\n    page.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    page.wait_for_event("Page.loadEventFired", timeout=10)\n    time.sleep(1)\n    \n    # 1. \u5168\u5c4f\u622a\u56fe\n    print("\\n--- \u6355\u83b7\u5168\u5c4f\u622a\u56fe ---")\n    screenshot = page.send_command("Page.captureScreenshot", {\n        "format": "png",\n        "quality": 90,\n        "captureBeyondViewport": True  # \u6355\u83b7\u6574\u4e2a\u9875\u9762\n    })\n    \n    if \'result\' in screenshot and \'data\' in screenshot[\'result\']:\n        screenshot_data = base64.b64decode(screenshot[\'result\'][\'data\'])\n        filename = f"screenshot_{int(time.time())}.png"\n        with open(filename, \'wb\') as f:\n            f.write(screenshot_data)\n        print(f"    \u2705 \u622a\u56fe\u5df2\u4fdd\u5b58: {filename}")\n        print(f"    \u5927\u5c0f: {len(screenshot_data)} \u5b57\u8282")\n    \n    # 2. \u6307\u5b9a\u533a\u57df\u622a\u56fe\n    print("\\n--- \u6355\u83b7\u6307\u5b9a\u533a\u57df\u622a\u56fe ---")\n    screenshot = page.send_command("Page.captureScreenshot", {\n        "format": "jpeg",\n        "quality": 80,\n        "clip": {\n            "x": 0,\n            "y": 0,\n            "width": 800,\n            "height": 600,\n            "scale": 1\n        }\n    })\n    \n    if \'result\' in screenshot and \'data\' in screenshot[\'result\']:\n        screenshot_data = base64.b64decode(screenshot[\'result\'][\'data\'])\n        filename = f"screenshot_clip_{int(time.time())}.jpg"\n        with open(filename, \'wb\') as f:\n            f.write(screenshot_data)\n        print(f"    \u2705 \u533a\u57df\u622a\u56fe\u5df2\u4fdd\u5b58: {filename}")\n    \n    # 3. \u751f\u6210 PDF\n    print("\\n--- \u751f\u6210 PDF ---")\n    pdf = page.send_command("Page.printToPDF", {\n        "landscape": False,\n        "displayHeaderFooter": True,\n        "printBackground": True,\n        "scale": 1.0,\n        "paperWidth": 8.5,\n        "paperHeight": 11,\n        "marginTop": 0.4,\n        "marginBottom": 0.4,\n        "marginLeft": 0.4,\n        "marginRight": 0.4\n    })\n    \n    if \'result\' in pdf and \'data\' in pdf[\'result\']:\n        pdf_data = base64.b64decode(pdf[\'result\'][\'data\'])\n        filename = f"page_{int(time.time())}.pdf"\n        with open(filename, \'wb\') as f:\n            f.write(pdf_data)\n        print(f"    \u2705 PDF \u5df2\u4fdd\u5b58: {filename}")\n        print(f"    \u5927\u5c0f: {len(pdf_data)} \u5b57\u8282")\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 4: \u9875\u9762\u8d44\u6e90\u7ba1\u7406\n# ========================================\ndef example_page_resources():\n    """\n    \u6f14\u793a\u9875\u9762\u8d44\u6e90\u7ba1\u7406:\n    1. Page.getResourceTree - \u83b7\u53d6\u8d44\u6e90\u6811\n    2. Page.getResourceContent - \u83b7\u53d6\u8d44\u6e90\u5185\u5bb9\n    3. Page.frameAttached - \u6846\u67b6\u9644\u52a0\u4e8b\u4ef6\n    4. Page.frameDetached - \u6846\u67b6\u5206\u79bb\u4e8b\u4ef6\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 4: \u9875\u9762\u8d44\u6e90\u7ba1\u7406")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    \n    def handle_frame_attached(event):\n        frame_id = event[\'params\'].get(\'frameId\', \'\')[:20]\n        parent_id = event[\'params\'].get(\'parentFrameId\', \'\')[:20]\n        print(f"\\n\ud83d\udd17 \u6846\u67b6\u9644\u52a0: {frame_id}... (\u7236: {parent_id}...)")\n    \n    def handle_frame_detached(event):\n        frame_id = event[\'params\'].get(\'frameId\', \'\')[:20]\n        print(f"\\n\u274c \u6846\u67b6\u5206\u79bb: {frame_id}...")\n    \n    page.on_event("Page.frameAttached", handle_frame_attached)\n    page.on_event("Page.frameDetached", handle_frame_detached)\n    page.send_command("Page.enable")\n    \n    # \u5bfc\u822a\u5230\u6709\u591a\u4e2a\u8d44\u6e90\u7684\u9875\u9762\n    page.send_command("Page.navigate", {\n        "url": "https://news.ycombinator.com"\n    })\n    page.wait_for_event("Page.loadEventFired", timeout=10)\n    time.sleep(2)\n    \n    # 1. \u83b7\u53d6\u8d44\u6e90\u6811\n    print("\\n--- \u83b7\u53d6\u8d44\u6e90\u6811 ---")\n    resource_tree = page.send_command("Page.getResourceTree")\n    \n    if \'result\' in resource_tree and \'frameTree\' in resource_tree[\'result\']:\n        frame_tree = resource_tree[\'result\'][\'frameTree\']\n        frame = frame_tree.get(\'frame\', {})\n        resources = frame_tree.get(\'resources\', [])\n        \n        print(f"\\n\u4e3b\u6846\u67b6:")\n        print(f"    ID: {frame.get(\'id\', \'N/A\')[:30]}...")\n        print(f"    URL: {frame.get(\'url\', \'N/A\')}")\n        print(f"    MIME \u7c7b\u578b: {frame.get(\'mimeType\', \'N/A\')}")\n        \n        print(f"\\n\u8d44\u6e90\u5217\u8868 (\u5171 {len(resources)} \u4e2a):")\n        for i, resource in enumerate(resources[:10], 1):  # \u53ea\u663e\u793a\u524d10\u4e2a\n            print(f"    {i}. {resource.get(\'type\', \'N/A\'):15} - {resource.get(\'url\', \'N/A\')[:80]}")\n        \n        if len(resources) > 10:\n            print(f"    ... \u8fd8\u6709 {len(resources) - 10} \u4e2a\u8d44\u6e90")\n        \n        # 2. \u83b7\u53d6\u7b2c\u4e00\u4e2a\u8d44\u6e90\u7684\u5185\u5bb9\n        if resources:\n            first_resource = resources[0]\n            print(f"\\n--- \u83b7\u53d6\u8d44\u6e90\u5185\u5bb9 ---")\n            print(f"    \u8d44\u6e90 URL: {first_resource.get(\'url\', \'N/A\')[:80]}")\n            \n            content = page.send_command("Page.getResourceContent", {\n                "frameId": frame.get(\'id\'),\n                "url": first_resource.get(\'url\')\n            })\n            \n            if \'result\' in content:\n                content_data = content[\'result\'].get(\'content\', \'\')\n                is_base64 = content[\'result\'].get(\'base64Encoded\', False)\n                print(f"    Base64 \u7f16\u7801: {is_base64}")\n                print(f"    \u5185\u5bb9\u5927\u5c0f: {len(content_data)} \u5b57\u7b26")\n                if not is_base64:\n                    print(f"    \u5185\u5bb9\u9884\u89c8: {content_data[:200]}...")\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 5: JavaScript \u5bf9\u8bdd\u6846\u5904\u7406\n# ========================================\ndef example_javascript_dialogs():\n    """\n    \u6f14\u793a JavaScript \u5bf9\u8bdd\u6846\u5904\u7406:\n    1. Page.javascriptDialogOpening - \u5bf9\u8bdd\u6846\u6253\u5f00\u4e8b\u4ef6\n    2. Page.handleJavaScriptDialog - \u5904\u7406\u5bf9\u8bdd\u6846\n    3. alert, confirm, prompt \u62e6\u622a\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 5: JavaScript \u5bf9\u8bdd\u6846\u5904\u7406")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    \n    dialog_count = [0]\n    \n    def handle_dialog_opening(event):\n        dialog_count[0] += 1\n        params = event[\'params\']\n        dialog_type = params.get(\'type\', \'N/A\')\n        message = params.get(\'message\', \'N/A\')\n        default_prompt = params.get(\'defaultPrompt\', \'\')\n        \n        print(f"\\n\ud83d\udcac \u5bf9\u8bdd\u6846 #{dialog_count[0]} \u6253\u5f00:")\n        print(f"    \u7c7b\u578b: {dialog_type}")\n        print(f"    \u6d88\u606f: {message}")\n        if default_prompt:\n            print(f"    \u9ed8\u8ba4\u503c: {default_prompt}")\n        \n        # \u81ea\u52a8\u5904\u7406\u5bf9\u8bdd\u6846\n        if dialog_type == "alert":\n            print(f"    \u2192 \u81ea\u52a8\u63a5\u53d7 alert")\n            page.send_command("Page.handleJavaScriptDialog", {\n                "accept": True\n            })\n        elif dialog_type == "confirm":\n            print(f"    \u2192 \u81ea\u52a8\u786e\u8ba4 confirm")\n            page.send_command("Page.handleJavaScriptDialog", {\n                "accept": True\n            })\n        elif dialog_type == "prompt":\n            print(f"    \u2192 \u81ea\u52a8\u8f93\u5165 prompt: \'\u81ea\u52a8\u56de\u590d\'")\n            page.send_command("Page.handleJavaScriptDialog", {\n                "accept": True,\n                "promptText": "\u81ea\u52a8\u56de\u590d"\n            })\n    \n    page.on_event("Page.javascriptDialogOpening", handle_dialog_opening)\n    page.send_command("Page.enable")\n    page.send_command("Runtime.enable")\n    \n    # \u5bfc\u822a\u5230\u9875\u9762\n    page.send_command("Page.navigate", {\n        "url": "https://example.com"\n    })\n    page.wait_for_event("Page.loadEventFired", timeout=10)\n    \n    # 1. \u89e6\u53d1 alert\n    print("\\n--- \u89e6\u53d1 alert ---")\n    page.send_command("Runtime.evaluate", {\n        "expression": "alert(\'\u8fd9\u662f\u4e00\u4e2a alert \u5bf9\u8bdd\u6846\')"\n    })\n    time.sleep(1)\n    \n    # 2. \u89e6\u53d1 confirm\n    print("\\n--- \u89e6\u53d1 confirm ---")\n    result = page.send_command("Runtime.evaluate", {\n        "expression": "confirm(\'\u786e\u8ba4\u64cd\u4f5c\u5417\uff1f\')",\n        "awaitPromise": True\n    })\n    time.sleep(1)\n    \n    # 3. \u89e6\u53d1 prompt\n    print("\\n--- \u89e6\u53d1 prompt ---")\n    result = page.send_command("Runtime.evaluate", {\n        "expression": "prompt(\'\u8bf7\u8f93\u5165\u60a8\u7684\u540d\u5b57:\', \'\u9ed8\u8ba4\u540d\u79f0\')",\n        "awaitPromise": True\n    })\n    time.sleep(1)\n    \n    print(f"\\n\ud83d\udcca \u603b\u5171\u5904\u7406\u4e86 {dialog_count[0]} \u4e2a\u5bf9\u8bdd\u6846")\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 6: \u9875\u9762\u89c6\u53e3\u548c\u8bbe\u5907\u6a21\u62df\n# ========================================\ndef example_viewport_and_emulation():\n    """\n    \u6f14\u793a\u89c6\u53e3\u548c\u8bbe\u5907\u6a21\u62df:\n    1. Page.setDeviceMetricsOverride - \u8bbe\u7f6e\u8bbe\u5907\u6307\u6807\n    2. Emulation.setTouchEmulationEnabled - \u542f\u7528\u89e6\u6478\u6a21\u62df\n    3. Emulation.setGeolocationOverride - \u8bbe\u7f6e\u5730\u7406\u4f4d\u7f6e\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 6: \u89c6\u53e3\u548c\u8bbe\u5907\u6a21\u62df")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    page.send_command("Page.enable")\n    \n    # 1. \u8bbe\u7f6e\u79fb\u52a8\u8bbe\u5907\u89c6\u53e3 (iPhone 12)\n    print("\\n--- \u6a21\u62df iPhone 12 ---")\n    page.send_command("Emulation.setDeviceMetricsOverride", {\n        "width": 390,\n        "height": 844,\n        "deviceScaleFactor": 3,\n        "mobile": True,\n        "screenOrientation": {\n            "type": "portraitPrimary",\n            "angle": 0\n        }\n    })\n    \n    # 2. \u8bbe\u7f6e User-Agent\n    page.send_command("Emulation.setUserAgentOverride", {\n        "userAgent": "Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15"\n    })\n    \n    # 3. \u542f\u7528\u89e6\u6478\u6a21\u62df\n    page.send_command("Emulation.setTouchEmulationEnabled", {\n        "enabled": True,\n        "maxTouchPoints": 5\n    })\n    \n    # 4. \u8bbe\u7f6e\u5730\u7406\u4f4d\u7f6e\n    print("\\n--- \u8bbe\u7f6e\u5730\u7406\u4f4d\u7f6e (\u7ebd\u7ea6) ---")\n    page.send_command("Emulation.setGeolocationOverride", {\n        "latitude": 40.7128,\n        "longitude": -74.0060,\n        "accuracy": 100\n    })\n    \n    # \u5bfc\u822a\u5230\u9875\u9762\n    page.send_command("Page.navigate", {\n        "url": "https://www.whatismybrowser.com"\n    })\n    page.wait_for_event("Page.loadEventFired", timeout=10)\n    time.sleep(2)\n    \n    # \u622a\u56fe\u770b\u6548\u679c\n    screenshot = page.send_command("Page.captureScreenshot", {\n        "format": "png"\n    })\n    \n    if \'result\' in screenshot and \'data\' in screenshot[\'result\']:\n        screenshot_data = base64.b64decode(screenshot[\'result\'][\'data\'])\n        filename = f"mobile_screenshot_{int(time.time())}.png"\n        with open(filename, \'wb\') as f:\n            f.write(screenshot_data)\n        print(f"\\n\u2705 \u79fb\u52a8\u7aef\u622a\u56fe\u5df2\u4fdd\u5b58: {filename}")\n    \n    # 5. \u6062\u590d\u6b63\u5e38\u89c6\u53e3\n    print("\\n--- \u6062\u590d\u684c\u9762\u89c6\u53e3 ---")\n    page.send_command("Emulation.clearDeviceMetricsOverride")\n    \n    page.close()\n\n\n# ========================================\n# \u793a\u4f8b 7: \u7efc\u5408\u5e94\u7528 - \u9875\u9762\u76d1\u63a7\u5668\n# ========================================\ndef example_page_monitor():\n    """\n    \u7efc\u5408\u793a\u4f8b: \u5b9e\u73b0\u5b8c\u6574\u7684\u9875\u9762\u76d1\u63a7\n    1. \u76d1\u63a7\u6240\u6709\u9875\u9762\u4e8b\u4ef6\n    2. \u6027\u80fd\u6307\u6807\u6536\u96c6\n    3. \u8d44\u6e90\u52a0\u8f7d\u7edf\u8ba1\n    4. \u9519\u8bef\u6355\u83b7\n    """\n    print("\\n" + "="*60)\n    print("\u793a\u4f8b 7: \u9875\u9762\u76d1\u63a7\u5668")\n    print("="*60)\n    \n    page = CDPPage(get_websocket_url())\n    \n    # \u7edf\u8ba1\u6570\u636e\n    stats = {\n        "navigation_count": 0,\n        "load_time": None,\n        "dom_content_time": None,\n        "resources_loaded": 0,\n        "javascript_errors": 0,\n        "console_messages": 0,\n        "dialogs_opened": 0\n    }\n    \n    start_time = time.time()\n    \n    # \u4e8b\u4ef6\u5904\u7406\u5668\n    def handle_frame_navigated(event):\n        stats["navigation_count"] += 1\n        url = event[\'params\'].get(\'frame\', {}).get(\'url\', \'N/A\')\n        print(f"\\n\ud83d\udccd \u9875\u9762\u5bfc\u822a #{stats[\'navigation_count\']}: {url[:80]}")\n    \n    def handle_load_event(event):\n        stats["load_time"] = time.time() - start_time\n        print(f"\\n\u2705 \u9875\u9762\u52a0\u8f7d\u5b8c\u6210: {stats[\'load_time\']:.2f}\u79d2")\n    \n    def handle_dom_content(event):\n        stats["dom_content_time"] = time.time() - start_time\n        print(f"\\n\u2705 DOM \u5185\u5bb9\u52a0\u8f7d: {stats[\'dom_content_time\']:.2f}\u79d2")\n    \n    def handle_console_message(event):\n        stats["console_messages"] += 1\n        params = event[\'params\']\n        level = params.get(\'level\', \'log\')\n        text = params.get(\'text\', \'\')\n        print(f"\\n\ud83d\udcac \u63a7\u5236\u53f0 [{level}]: {text[:100]}")\n    \n    def handle_exception(event):\n        stats["javascript_errors"] += 1\n        params = event[\'params\']\n        description = params.get(\'exceptionDetails\', {}).get(\'text\', \'N/A\')\n        print(f"\\n\u274c JavaScript \u9519\u8bef #{stats[\'javascript_errors\']}: {description[:100]}")\n    \n    def handle_dialog(event):\n        stats["dialogs_opened"] += 1\n        dialog_type = event[\'params\'].get(\'type\', \'N/A\')\n        print(f"\\n\ud83d\udcac \u5bf9\u8bdd\u6846 #{stats[\'dialogs_opened\']}: {dialog_type}")\n        page.send_command("Page.handleJavaScriptDialog", {"accept": True})\n    \n    # \u6ce8\u518c\u6240\u6709\u4e8b\u4ef6\n    page.on_event("Page.frameNavigated", handle_frame_navigated)\n    page.on_event("Page.loadEventFired", handle_load_event)\n    page.on_event("Page.domContentEventFired", handle_dom_content)\n    page.on_event("Runtime.consoleAPICalled", handle_console_message)\n    page.on_event("Runtime.exceptionThrown", handle_exception)\n    page.on_event("Page.javascriptDialogOpening", handle_dialog)\n    \n    # \u542f\u7528\u6240\u6709\u5fc5\u8981\u7684\u57df\n    page.send_command("Page.enable")\n    page.send_command("Runtime.enable")\n    page.send_command("Network.enable")\n    \n    # \u542f\u7528\u63a7\u5236\u53f0\u6d88\u606f\n    page.send_command("Runtime.consoleAPICalled")\n    \n    # \u5bfc\u822a\u5230\u9875\u9762\n    print("\\n--- \u5f00\u59cb\u76d1\u63a7 ---")\n    page.send_command("Page.navigate", {\n        "url": "https://news.ycombinator.com"\n    })\n    \n    # \u76d1\u63a710\u79d2\n    time.sleep(10)\n    \n    # \u83b7\u53d6\u6027\u80fd\u6307\u6807\n    print("\\n--- \u83b7\u53d6\u6027\u80fd\u6307\u6807 ---")\n    metrics = page.send_command("Performance.getMetrics")\n    \n    if \'result\' in metrics and \'metrics\' in metrics[\'result\']:\n        print("\\n\ud83d\udcca \u6027\u80fd\u6307\u6807:")\n        for metric in metrics[\'result\'][\'metrics\'][:10]:\n            print(f"    {metric[\'name\']}: {metric[\'value\']}")\n    \n    # \u663e\u793a\u6700\u7ec8\u7edf\u8ba1\n    print("\\n" + "="*60)\n    print("\ud83d\udcca \u76d1\u63a7\u6458\u8981:")\n    print(f"    \u5bfc\u822a\u6b21\u6570: {stats[\'navigation_count\']}")\n    print(f"    DOM \u52a0\u8f7d\u65f6\u95f4: {stats[\'dom_content_time\']:.2f}\u79d2" if stats[\'dom_content_time\'] else "    DOM \u52a0\u8f7d\u65f6\u95f4: N/A")\n    print(f"    \u5b8c\u5168\u52a0\u8f7d\u65f6\u95f4: {stats[\'load_time\']:.2f}\u79d2" if stats[\'load_time\'] else "    \u5b8c\u5168\u52a0\u8f7d\u65f6\u95f4: N/A")\n    print(f"    \u63a7\u5236\u53f0\u6d88\u606f: {stats[\'console_messages\']}")\n    print(f"    JavaScript \u9519\u8bef: {stats[\'javascript_errors\']}")\n    print(f"    \u5bf9\u8bdd\u6846: {stats[\'dialogs_opened\']}")\n    print("="*60)\n    \n    page.close()\n\n\n# ========================================\n# \u4e3b\u51fd\u6570\n# ========================================\nif __name__ == "__main__":\n    print("\\n" + "="*60)\n    print("CDP Page.enable \u5b8c\u6574\u793a\u4f8b\u96c6")\n    print("="*60)\n    print("\\n\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8:")\n    print("chrome --remote-debugging-port=9222 --user-data-dir=/tmp/chrome-debug")\n    print("\\n\u9009\u62e9\u8981\u8fd0\u884c\u7684\u793a\u4f8b:")\n    print("1. \u9875\u9762\u751f\u547d\u5468\u671f\u76d1\u542c")\n    print("2. \u9875\u9762\u5bfc\u822a\u63a7\u5236")\n    print("3. \u622a\u56fe\u548c PDF \u751f\u6210")\n    print("4. \u9875\u9762\u8d44\u6e90\u7ba1\u7406")\n    print("5. JavaScript \u5bf9\u8bdd\u6846\u5904\u7406")\n    print("6. \u89c6\u53e3\u548c\u8bbe\u5907\u6a21\u62df")\n    print("7. \u9875\u9762\u76d1\u63a7\u5668\uff08\u7efc\u5408\uff09")\n    print("0. \u8fd0\u884c\u6240\u6709\u793a\u4f8b")\n    \n    try:\n        choice = input("\\n\u8bf7\u8f93\u5165\u9009\u62e9 (0-7): ").strip()\n        \n        examples = {\n            "1": example_page_lifecycle,\n            "2": example_page_navigation,\n            "3": example_capture_screenshot,\n            "4": example_page_resources,\n            "5": example_javascript_dialogs,\n            "6": example_viewport_and_emulation,\n            "7": example_page_monitor\n        }\n        \n        if choice == "0":\n            for name, example in examples.items():\n                print(f"\\n{\'=\'*60}")\n                print(f"\u8fd0\u884c\u793a\u4f8b {name}...")\n                print(f"{\'=\'*60}")\n                example()\n                time.sleep(2)\n        elif choice in examples:\n            examples[choice]()\n        else:\n            print("\u65e0\u6548\u9009\u62e9")\n        \n        print("\\n\u2705 \u793a\u4f8b\u6267\u884c\u5b8c\u6210\uff01")\n        \n    except requests.exceptions.ConnectionError:\n        print("\\n\u274c \u9519\u8bef: \u65e0\u6cd5\u8fde\u63a5\u5230 Chrome")\n        print("\u8bf7\u786e\u4fdd Chrome \u5df2\u4f7f\u7528 --remote-debugging-port=9222 \u542f\u52a8")\n    except KeyboardInterrupt:\n        print("\\n\\n\u26a0\ufe0f \u7528\u6237\u4e2d\u65ad")\n    except Exception as e:\n        print(f"\\n\u274c \u53d1\u751f\u9519\u8bef: {e}")\n        import traceback\n        traceback.print_exc()\n    \n# %%\n'})})]})}function l(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(m,{...n})}):m(n)}}}]);