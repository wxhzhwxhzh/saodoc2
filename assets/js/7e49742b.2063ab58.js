"use strict";(globalThis.webpackChunkmy_tutorial_site=globalThis.webpackChunkmy_tutorial_site||[]).push([[275],{8453:(n,e,t)=>{t.d(e,{R:()=>i,x:()=>a});var s=t(6540);const r={},o=s.createContext(r);function i(n){const e=s.useContext(o);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),s.createElement(o.Provider,{value:e},n.children)}},8524:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>u});const s=JSON.parse('{"id":"\u5176\u4ed6/playwright/intro9","title":"\ud83d\udc9croute.fulfill()","description":"route.fulfill() \u662f Playwright \u8def\u7531\u62e6\u622a\u529f\u80fd\u4e2d\u7684\u53e6\u4e00\u4e2a\u6838\u5fc3\u65b9\u6cd5\uff0c\u5b83\u5141\u8bb8\u4f60\u5b8c\u5168\u66ff\u4ee3\u539f\u59cb\u8bf7\u6c42\u7684\u54cd\u5e94\uff0c\u800c\u4e0d\u662f\u8ba9\u8bf7\u6c42\u7ee7\u7eed\u5230\u5b9e\u9645\u7684\u670d\u52a1\u5668\u3002\u8fd9\u5bf9\u4e8e\u6a21\u62dfAPI\u54cd\u5e94\u3001\u6d4b\u8bd5\u9519\u8bef\u573a\u666f\u3001\u79bb\u7ebf\u6d4b\u8bd5\u7b49\u975e\u5e38\u6709\u7528\u3002","source":"@site/docs/\u5176\u4ed6/playwright/9.fullfill.md","sourceDirName":"\u5176\u4ed6/playwright","slug":"/\u5176\u4ed6/playwright/intro9","permalink":"/saodoc2/docs/\u5176\u4ed6/playwright/intro9","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"intro9","permalink":"/pw/intro9","title":"\ud83d\udc9croute.fulfill()"},"sidebar":"otherSidebar","previous":{"title":"\ud83d\udc9croute.continue_()","permalink":"/saodoc2/docs/\u5176\u4ed6/playwright/intro8"},"next":{"title":"\ud83d\udc9c\u7f51\u7edc\u529f\u80fd","permalink":"/saodoc2/docs/\u5176\u4ed6/playwright/intro10"}}');var r=t(4848),o=t(8453);const i={id:"intro9",permalink:"/pw/intro9",title:"\ud83d\udc9croute.fulfill()"},a=void 0,l={},u=[{value:"\u57fa\u672c\u6982\u5ff5",id:"\u57fa\u672c\u6982\u5ff5",level:2},{value:"\u57fa\u7840\u7528\u6cd5",id:"\u57fa\u7840\u7528\u6cd5",level:2},{value:"1. \u7b80\u5355\u7684\u54cd\u5e94\u66ff\u6362",id:"1-\u7b80\u5355\u7684\u54cd\u5e94\u66ff\u6362",level:3},{value:"2. \u8fd4\u56de\u9759\u6001\u6587\u4ef6\u5185\u5bb9",id:"2-\u8fd4\u56de\u9759\u6001\u6587\u4ef6\u5185\u5bb9",level:3},{value:"\u5b8c\u6574\u7684\u53c2\u6570\u5217\u8868",id:"\u5b8c\u6574\u7684\u53c2\u6570\u5217\u8868",level:2},{value:"\u9ad8\u7ea7\u7528\u6cd5",id:"\u9ad8\u7ea7\u7528\u6cd5",level:2},{value:"1. \u6a21\u62dfAPI\u54cd\u5e94",id:"1-\u6a21\u62dfapi\u54cd\u5e94",level:3},{value:"2. \u6a21\u62df\u4e0d\u540c\u7684HTTP\u72b6\u6001\u7801",id:"2-\u6a21\u62df\u4e0d\u540c\u7684http\u72b6\u6001\u7801",level:3},{value:"3. \u57fa\u4e8e\u6587\u4ef6\u7684\u54cd\u5e94",id:"3-\u57fa\u4e8e\u6587\u4ef6\u7684\u54cd\u5e94",level:3},{value:"4. \u52a8\u6001\u54cd\u5e94\u751f\u6210",id:"4-\u52a8\u6001\u54cd\u5e94\u751f\u6210",level:3},{value:"5. \u54cd\u5e94\u4fee\u6539\u548c\u589e\u5f3a",id:"5-\u54cd\u5e94\u4fee\u6539\u548c\u589e\u5f3a",level:3},{value:"6. \u56fe\u7247\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5904\u7406",id:"6-\u56fe\u7247\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5904\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406\u548c\u8c03\u8bd5",id:"\u9519\u8bef\u5904\u7406\u548c\u8c03\u8bd5",level:2},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",id:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",level:2},{value:"1. \u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\u6a21\u62df",id:"1-\u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\u6a21\u62df",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function d(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"route.fulfill()"})," \u662f Playwright \u8def\u7531\u62e6\u622a\u529f\u80fd\u4e2d\u7684\u53e6\u4e00\u4e2a\u6838\u5fc3\u65b9\u6cd5\uff0c\u5b83\u5141\u8bb8\u4f60\u5b8c\u5168\u66ff\u4ee3\u539f\u59cb\u8bf7\u6c42\u7684\u54cd\u5e94\uff0c\u800c\u4e0d\u662f\u8ba9\u8bf7\u6c42\u7ee7\u7eed\u5230\u5b9e\u9645\u7684\u670d\u52a1\u5668\u3002\u8fd9\u5bf9\u4e8e\u6a21\u62dfAPI\u54cd\u5e94\u3001\u6d4b\u8bd5\u9519\u8bef\u573a\u666f\u3001\u79bb\u7ebf\u6d4b\u8bd5\u7b49\u975e\u5e38\u6709\u7528\u3002"]}),"\n",(0,r.jsx)(e.h2,{id:"\u57fa\u672c\u6982\u5ff5",children:"\u57fa\u672c\u6982\u5ff5"}),"\n",(0,r.jsxs)(e.p,{children:["\u5f53\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"route.fulfill()"})," \u65f6\uff0cPlaywright \u4e0d\u4f1a\u53d1\u9001\u5b9e\u9645\u7684\u7f51\u7edc\u8bf7\u6c42\uff0c\u800c\u662f\u76f4\u63a5\u8fd4\u56de\u4f60\u63d0\u4f9b\u7684\u6a21\u62df\u54cd\u5e94\u3002\u8fd9\u6837\u53ef\u4ee5\uff1a"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5b8c\u5168\u63a7\u5236\u54cd\u5e94\u5185\u5bb9"}),"\n",(0,r.jsx)(e.li,{children:"\u6a21\u62df\u5404\u79cd\u670d\u52a1\u5668\u72b6\u6001"}),"\n",(0,r.jsx)(e.li,{children:"\u907f\u514d\u4f9d\u8d56\u5916\u90e8\u670d\u52a1"}),"\n",(0,r.jsx)(e.li,{children:"\u52a0\u5feb\u6d4b\u8bd5\u6267\u884c\u901f\u5ea6"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u57fa\u7840\u7528\u6cd5",children:"\u57fa\u7840\u7528\u6cd5"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u7b80\u5355\u7684\u54cd\u5e94\u66ff\u6362",children:"1. \u7b80\u5355\u7684\u54cd\u5e94\u66ff\u6362"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from playwright.sync_api import sync_playwright\n\nwith sync_playwright() as p:\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context()\n    page = context.new_page()\n    \n    def handle_route(route, request):\n        if "/api/user" in request.url:\n            # \u8fd4\u56de\u6a21\u62df\u7684\u7528\u6237\u6570\u636e\n            route.fulfill(\n                status=200,\n                headers={"Content-Type": "application/json"},\n                body=\'{"id": 123, "name": "Test User", "email": "test@example.com"}\'\n            )\n        else:\n            route.continue_()\n    \n    page.route("**/*", handle_route)\n    page.goto("https://example.com")\n    \n    browser.close()\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u8fd4\u56de\u9759\u6001\u6587\u4ef6\u5185\u5bb9",children:"2. \u8fd4\u56de\u9759\u6001\u6587\u4ef6\u5185\u5bb9"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'def handle_route(route, request):\n    if request.url.endswith(\'.css\'):\n        # \u8fd4\u56de\u81ea\u5b9a\u4e49CSS\n        css_content = """\n        body { background-color: #f0f0f0; }\n        .test-element { color: red; }\n        """\n        route.fulfill(\n            status=200,\n            headers={"Content-Type": "text/css"},\n            body=css_content\n        )\n    else:\n        route.continue_()\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5b8c\u6574\u7684\u53c2\u6570\u5217\u8868",children:"\u5b8c\u6574\u7684\u53c2\u6570\u5217\u8868"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"route.fulfill()"})," \u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'route.fulfill(\n    status=200,                              # HTTP\u72b6\u6001\u7801\n    headers={"Content-Type": "application/json"},  # \u54cd\u5e94\u5934\n    body="response content",                 # \u54cd\u5e94\u4f53\uff08\u5b57\u7b26\u4e32\uff09\n    body_bytes=b"binary content",           # \u54cd\u5e94\u4f53\uff08\u5b57\u8282\uff09\n    path="/path/to/file.json",              # \u4ece\u6587\u4ef6\u8bfb\u53d6\u54cd\u5e94\n    content_type="application/json",         # \u5185\u5bb9\u7c7b\u578b\uff08\u7b80\u5316\u8bbe\u7f6e\uff09\n    response=original_response               # \u57fa\u4e8e\u73b0\u6709\u54cd\u5e94\u4fee\u6539\n)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u9ad8\u7ea7\u7528\u6cd5",children:"\u9ad8\u7ea7\u7528\u6cd5"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u6a21\u62dfapi\u54cd\u5e94",children:"1. \u6a21\u62dfAPI\u54cd\u5e94"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import json\nfrom datetime import datetime\n\nclass APISimulator:\n    def __init__(self):\n        self.users = [\n            {"id": 1, "name": "Alice", "email": "alice@example.com"},\n            {"id": 2, "name": "Bob", "email": "bob@example.com"},\n            {"id": 3, "name": "Charlie", "email": "charlie@example.com"}\n        ]\n        self.posts = [\n            {"id": 1, "title": "First Post", "author_id": 1, "content": "Hello World!"},\n            {"id": 2, "title": "Second Post", "author_id": 2, "content": "This is a test."}\n        ]\n    \n    def handle_route(self, route, request):\n        url = request.url\n        method = request.method\n        \n        # \u5904\u7406\u7528\u6237\u76f8\u5173API\n        if "/api/users" in url:\n            if method == "GET":\n                if url.endswith("/users"):\n                    # \u8fd4\u56de\u6240\u6709\u7528\u6237\n                    route.fulfill(\n                        status=200,\n                        headers={"Content-Type": "application/json"},\n                        body=json.dumps(self.users)\n                    )\n                else:\n                    # \u8fd4\u56de\u7279\u5b9a\u7528\u6237\n                    user_id = int(url.split("/")[-1])\n                    user = next((u for u in self.users if u["id"] == user_id), None)\n                    if user:\n                        route.fulfill(\n                            status=200,\n                            headers={"Content-Type": "application/json"},\n                            body=json.dumps(user)\n                        )\n                    else:\n                        route.fulfill(\n                            status=404,\n                            headers={"Content-Type": "application/json"},\n                            body=\'{"error": "User not found"}\'\n                        )\n            \n            elif method == "POST":\n                # \u521b\u5efa\u65b0\u7528\u6237\n                try:\n                    new_user_data = json.loads(request.post_data or "{}")\n                    new_user = {\n                        "id": len(self.users) + 1,\n                        "name": new_user_data.get("name"),\n                        "email": new_user_data.get("email")\n                    }\n                    self.users.append(new_user)\n                    \n                    route.fulfill(\n                        status=201,\n                        headers={"Content-Type": "application/json"},\n                        body=json.dumps(new_user)\n                    )\n                except json.JSONDecodeError:\n                    route.fulfill(\n                        status=400,\n                        headers={"Content-Type": "application/json"},\n                        body=\'{"error": "Invalid JSON"}\'\n                    )\n        \n        # \u5904\u7406\u6587\u7ae0API\n        elif "/api/posts" in url:\n            route.fulfill(\n                status=200,\n                headers={"Content-Type": "application/json"},\n                body=json.dumps(self.posts)\n            )\n        \n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\nsimulator = APISimulator()\n\nwith sync_playwright() as p:\n    browser = p.chromium.launch(headless=False)\n    context = browser.new_context()\n    page = context.new_page()\n    \n    page.route("**/*", simulator.handle_route)\n    \n    # \u6d4b\u8bd5\u9875\u9762\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528\u6a21\u62df\u7684API\n    page.goto("https://your-app.com")\n    \n    browser.close()\n'})}),"\n",(0,r.jsx)(e.h3,{id:"2-\u6a21\u62df\u4e0d\u540c\u7684http\u72b6\u6001\u7801",children:"2. \u6a21\u62df\u4e0d\u540c\u7684HTTP\u72b6\u6001\u7801"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'class HTTPStatusSimulator:\n    def __init__(self):\n        self.request_count = 0\n    \n    def handle_route(self, route, request):\n        self.request_count += 1\n        \n        if "/api/flaky-endpoint" in request.url:\n            # \u6a21\u62df\u4e0d\u7a33\u5b9a\u7684\u670d\u52a1\n            if self.request_count % 3 == 0:\n                # \u6bcf\u7b2c3\u4e2a\u8bf7\u6c42\u5931\u8d25\n                route.fulfill(\n                    status=500,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"error": "Internal Server Error", "code": "SERVER_ERROR"}\'\n                )\n            elif self.request_count % 5 == 0:\n                # \u6bcf\u7b2c5\u4e2a\u8bf7\u6c42\u8d85\u65f6\n                route.fulfill(\n                    status=408,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"error": "Request Timeout", "code": "TIMEOUT"}\'\n                )\n            else:\n                # \u6b63\u5e38\u54cd\u5e94\n                route.fulfill(\n                    status=200,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"status": "success", "data": "Everything is fine"}\'\n                )\n        \n        elif "/api/auth" in request.url:\n            # \u6a21\u62df\u8ba4\u8bc1\u5931\u8d25\n            auth_header = request.headers.get("Authorization", "")\n            if not auth_header or "Bearer valid-token" not in auth_header:\n                route.fulfill(\n                    status=401,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"error": "Unauthorized", "code": "INVALID_TOKEN"}\'\n                )\n            else:\n                route.fulfill(\n                    status=200,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"user": "authenticated_user", "role": "admin"}\'\n                )\n        \n        elif "/api/rate-limited" in request.url:\n            # \u6a21\u62df\u9650\u6d41\n            route.fulfill(\n                status=429,\n                headers={\n                    "Content-Type": "application/json",\n                    "Retry-After": "60"\n                },\n                body=\'{"error": "Too Many Requests", "retry_after": 60}\'\n            )\n        \n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\nstatus_simulator = HTTPStatusSimulator()\npage.route("**/api/**", status_simulator.handle_route)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"3-\u57fa\u4e8e\u6587\u4ef6\u7684\u54cd\u5e94",children:"3. \u57fa\u4e8e\u6587\u4ef6\u7684\u54cd\u5e94"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import os\nimport mimetypes\n\nclass FileBasedMockServer:\n    def __init__(self, mock_dir="./mock_responses"):\n        self.mock_dir = mock_dir\n        self.ensure_mock_dir()\n        self.create_sample_files()\n    \n    def ensure_mock_dir(self):\n        if not os.path.exists(self.mock_dir):\n            os.makedirs(self.mock_dir)\n    \n    def create_sample_files(self):\n        # \u521b\u5efa\u793a\u4f8b\u6a21\u62df\u6587\u4ef6\n        samples = {\n            "users.json": \'{"users": [{"id": 1, "name": "John"}, {"id": 2, "name": "Jane"}]}\',\n            "products.json": \'{"products": [{"id": 1, "name": "Laptop", "price": 999}]}\',\n            "error_500.json": \'{"error": "Internal Server Error", "message": "Something went wrong"}\',\n            "styles.css": "body { font-family: Arial; background: #f0f0f0; }",\n            "index.html": "<html><body><h1>Mock Response</h1></body></html>"\n        }\n        \n        for filename, content in samples.items():\n            filepath = os.path.join(self.mock_dir, filename)\n            if not os.path.exists(filepath):\n                with open(filepath, \'w\', encoding=\'utf-8\') as f:\n                    f.write(content)\n    \n    def handle_route(self, route, request):\n        url = request.url\n        \n        # \u6620\u5c04URL\u5230\u6587\u4ef6\n        url_to_file = {\n            "/api/users": "users.json",\n            "/api/products": "products.json",\n            "/api/error-test": "error_500.json",\n            "/styles.css": "styles.css",\n            "/mock-page": "index.html"\n        }\n        \n        # \u67e5\u627e\u5339\u914d\u7684\u6587\u4ef6\n        for url_pattern, filename in url_to_file.items():\n            if url_pattern in url:\n                filepath = os.path.join(self.mock_dir, filename)\n                \n                if os.path.exists(filepath):\n                    # \u6839\u636e\u6587\u4ef6\u6269\u5c55\u540d\u786e\u5b9a\u5185\u5bb9\u7c7b\u578b\n                    content_type, _ = mimetypes.guess_type(filepath)\n                    if not content_type:\n                        content_type = "text/plain"\n                    \n                    # \u7279\u6b8a\u5904\u7406\u9519\u8bef\u6587\u4ef6\n                    status_code = 500 if "error" in filename else 200\n                    \n                    route.fulfill(\n                        status=status_code,\n                        headers={"Content-Type": content_type},\n                        path=filepath\n                    )\n                    return\n        \n        # \u5982\u679c\u6ca1\u6709\u5339\u914d\u7684\u6587\u4ef6\uff0c\u7ee7\u7eed\u539f\u59cb\u8bf7\u6c42\n        route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\nmock_server = FileBasedMockServer()\npage.route("**/*", mock_server.handle_route)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"4-\u52a8\u6001\u54cd\u5e94\u751f\u6210",children:"4. \u52a8\u6001\u54cd\u5e94\u751f\u6210"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import random\nimport time\nfrom datetime import datetime\n\nclass DynamicResponseGenerator:\n    def __init__(self):\n        self.session_data = {}\n    \n    def generate_user_data(self):\n        names = ["Alice", "Bob", "Charlie", "Diana", "Eve"]\n        domains = ["example.com", "test.com", "demo.com"]\n        \n        return {\n            "id": random.randint(1, 1000),\n            "name": random.choice(names),\n            "email": f"{random.choice(names).lower()}@{random.choice(domains)}",\n            "created_at": datetime.now().isoformat(),\n            "last_active": datetime.now().isoformat(),\n            "score": random.randint(0, 100)\n        }\n    \n    def generate_analytics_data(self):\n        return {\n            "timestamp": datetime.now().isoformat(),\n            "page_views": random.randint(100, 1000),\n            "unique_visitors": random.randint(50, 500),\n            "bounce_rate": round(random.uniform(0.2, 0.8), 2),\n            "conversion_rate": round(random.uniform(0.01, 0.1), 3),\n            "performance": {\n                "load_time": round(random.uniform(0.5, 3.0), 2),\n                "render_time": round(random.uniform(0.1, 1.0), 2)\n            }\n        }\n    \n    def handle_route(self, route, request):\n        url = request.url\n        \n        if "/api/random-user" in url:\n            # \u751f\u6210\u968f\u673a\u7528\u6237\u6570\u636e\n            user_data = self.generate_user_data()\n            route.fulfill(\n                status=200,\n                headers={\n                    "Content-Type": "application/json",\n                    "X-Generated-At": datetime.now().isoformat()\n                },\n                body=json.dumps(user_data)\n            )\n        \n        elif "/api/analytics" in url:\n            # \u6a21\u62df\u5b9e\u65f6\u5206\u6790\u6570\u636e\n            analytics = self.generate_analytics_data()\n            route.fulfill(\n                status=200,\n                headers={\n                    "Content-Type": "application/json",\n                    "Cache-Control": "no-cache"\n                },\n                body=json.dumps(analytics)\n            )\n        \n        elif "/api/slow-response" in url:\n            # \u6a21\u62df\u6162\u54cd\u5e94\n            time.sleep(2)  # \u6ce8\u610f\uff1a\u8fd9\u4f1a\u963b\u585e\uff0c\u5b9e\u9645\u4f7f\u7528\u4e2d\u8003\u8651\u5f02\u6b65\n            route.fulfill(\n                status=200,\n                headers={"Content-Type": "application/json"},\n                body=\'{"message": "This was a slow response", "delay": "2 seconds"}\'\n            )\n        \n        elif "/api/conditional" in url:\n            # \u57fa\u4e8e\u8bf7\u6c42\u53c2\u6570\u7684\u6761\u4ef6\u54cd\u5e94\n            if "error=true" in url:\n                route.fulfill(\n                    status=400,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"error": "Simulated error condition"}\'\n                )\n            elif "empty=true" in url:\n                route.fulfill(\n                    status=200,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"data": [], "total": 0}\'\n                )\n            else:\n                route.fulfill(\n                    status=200,\n                    headers={"Content-Type": "application/json"},\n                    body=\'{"data": ["item1", "item2", "item3"], "total": 3}\'\n                )\n        \n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\ngenerator = DynamicResponseGenerator()\npage.route("**/api/**", generator.handle_route)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"5-\u54cd\u5e94\u4fee\u6539\u548c\u589e\u5f3a",children:"5. \u54cd\u5e94\u4fee\u6539\u548c\u589e\u5f3a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'class ResponseEnhancer:\n    def __init__(self):\n        self.request_id_counter = 0\n    \n    def handle_route(self, route, request):\n        self.request_id_counter += 1\n        \n        if "/api/" in request.url:\n            # \u5bf9\u6240\u6709API\u8bf7\u6c42\u6dfb\u52a0\u901a\u7528\u7684\u54cd\u5e94\u5934\u548c\u6570\u636e\n            \n            # \u9996\u5148\u83b7\u53d6\u539f\u59cb\u54cd\u5e94\uff08\u5982\u679c\u9700\u8981\u7684\u8bdd\uff09\n            # \u6ce8\u610f\uff1a\u8fd9\u91cc\u6f14\u793a\u7684\u662f\u5b8c\u5168\u66ff\u6362\u54cd\u5e94\u7684\u65b9\u5f0f\n            \n            if "/api/enhanced" in request.url:\n                # \u521b\u5efa\u589e\u5f3a\u7684\u54cd\u5e94\n                enhanced_response = {\n                    "meta": {\n                        "request_id": f"req_{self.request_id_counter}",\n                        "timestamp": datetime.now().isoformat(),\n                        "version": "1.0",\n                        "server": "mock-server"\n                    },\n                    "data": {\n                        "message": "This is an enhanced response",\n                        "features": ["caching", "versioning", "tracking"]\n                    },\n                    "links": {\n                        "self": request.url,\n                        "documentation": "https://api-docs.example.com"\n                    }\n                }\n                \n                route.fulfill(\n                    status=200,\n                    headers={\n                        "Content-Type": "application/json",\n                        "X-Request-ID": f"req_{self.request_id_counter}",\n                        "X-API-Version": "1.0",\n                        "X-Rate-Limit-Remaining": "100",\n                        "Cache-Control": "max-age=300"\n                    },\n                    body=json.dumps(enhanced_response, indent=2)\n                )\n            else:\n                route.continue_()\n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\nenhancer = ResponseEnhancer()\npage.route("**/*", enhancer.handle_route)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"6-\u56fe\u7247\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5904\u7406",children:"6. \u56fe\u7247\u548c\u4e8c\u8fdb\u5236\u6587\u4ef6\u5904\u7406"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import base64\n\nclass BinaryResponseHandler:\n    def __init__(self):\n        # 1x1\u50cf\u7d20\u7684\u900f\u660ePNG\u56fe\u7247\u7684base64\u7f16\u7801\n        self.tiny_png = base64.b64decode(\n            \'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==\'\n        )\n    \n    def handle_route(self, route, request):\n        url = request.url\n        \n        if any(ext in url for ext in [\'.png\', \'.jpg\', \'.jpeg\', \'.gif\']):\n            # \u8fd4\u56de\u5360\u4f4d\u56fe\u7247\n            route.fulfill(\n                status=200,\n                headers={"Content-Type": "image/png"},\n                body_bytes=self.tiny_png\n            )\n        \n        elif url.endswith(\'.pdf\'):\n            # \u8fd4\u56de\u7b80\u5355\u7684PDF\u5185\u5bb9\n            pdf_content = b"%PDF-1.4\\n1 0 obj\\n<<\\n/Type /Catalog\\n/Pages 2 0 R\\n>>\\nendobj\\n2 0 obj\\n<<\\n/Type /Pages\\n/Kids [3 0 R]\\n/Count 1\\n>>\\nendobj\\n3 0 obj\\n<<\\n/Type /Page\\n/Parent 2 0 R\\n/MediaBox [0 0 612 792]\\n>>\\nendobj\\nxref\\n0 4\\n0000000000 65535 f \\n0000000009 00000 n \\n0000000074 00000 n \\n0000000120 00000 n \\ntrailer\\n<<\\n/Size 4\\n/Root 1 0 R\\n>>\\nstartxref\\n174\\n%%EOF"\n            \n            route.fulfill(\n                status=200,\n                headers={\n                    "Content-Type": "application/pdf",\n                    "Content-Disposition": "inline; filename=test.pdf"\n                },\n                body_bytes=pdf_content\n            )\n        \n        elif url.endswith(\'.zip\'):\n            # \u8fd4\u56de\u7a7a\u7684ZIP\u6587\u4ef6\n            empty_zip = b\'PK\\x05\\x06\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\'\n            \n            route.fulfill(\n                status=200,\n                headers={\n                    "Content-Type": "application/zip",\n                    "Content-Disposition": "attachment; filename=empty.zip"\n                },\n                body_bytes=empty_zip\n            )\n        \n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\nbinary_handler = BinaryResponseHandler()\npage.route("**/*", binary_handler.handle_route)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u9519\u8bef\u5904\u7406\u548c\u8c03\u8bd5",children:"\u9519\u8bef\u5904\u7406\u548c\u8c03\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'class SafeRouteHandler:\n    def __init__(self):\n        self.error_count = 0\n    \n    def handle_route(self, route, request):\n        try:\n            if "/api/test" in request.url:\n                # \u6a21\u62df\u53ef\u80fd\u5931\u8d25\u7684\u64cd\u4f5c\n                data = self._process_request(request)\n                \n                route.fulfill(\n                    status=200,\n                    headers={"Content-Type": "application/json"},\n                    body=json.dumps(data)\n                )\n            else:\n                route.continue_()\n                \n        except Exception as e:\n            self.error_count += 1\n            print(f"Route\u5904\u7406\u9519\u8bef #{self.error_count}: {e}")\n            \n            # \u8fd4\u56de\u9519\u8bef\u54cd\u5e94\u800c\u4e0d\u662f\u8ba9\u6574\u4e2a\u6d4b\u8bd5\u5931\u8d25\n            route.fulfill(\n                status=500,\n                headers={"Content-Type": "application/json"},\n                body=json.dumps({\n                    "error": "Mock server error",\n                    "message": str(e),\n                    "error_count": self.error_count\n                })\n            )\n    \n    def _process_request(self, request):\n        # \u6a21\u62df\u4e00\u4e9b\u53ef\u80fd\u51fa\u9519\u7684\u5904\u7406\n        if "trigger_error" in request.url:\n            raise ValueError("Simulated processing error")\n        \n        return {"status": "success", "processed_at": datetime.now().isoformat()}\n\n# \u4f7f\u7528\u793a\u4f8b\nsafe_handler = SafeRouteHandler()\npage.route("**/*", safe_handler.handle_route)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'import hashlib\nfrom functools import lru_cache\n\nclass OptimizedMockServer:\n    def __init__(self):\n        self.response_cache = {}\n    \n    @lru_cache(maxsize=100)\n    def _generate_cached_response(self, cache_key):\n        """\u4f7f\u7528LRU\u7f13\u5b58\u6765\u907f\u514d\u91cd\u590d\u751f\u6210\u76f8\u540c\u7684\u54cd\u5e94"""\n        return {\n            "timestamp": datetime.now().isoformat(),\n            "data": f"Cached response for {cache_key}",\n            "cache_hit": True\n        }\n    \n    def _get_cache_key(self, request):\n        """\u4e3a\u8bf7\u6c42\u751f\u6210\u7f13\u5b58\u952e"""\n        key_parts = [\n            request.method,\n            request.url,\n            request.post_data or ""\n        ]\n        return hashlib.md5("|".join(key_parts).encode()).hexdigest()\n    \n    def handle_route(self, route, request):\n        if "/api/cached" in request.url:\n            cache_key = self._get_cache_key(request)\n            \n            # \u68c0\u67e5\u5185\u5b58\u7f13\u5b58\n            if cache_key in self.response_cache:\n                cached_response = self.response_cache[cache_key]\n                route.fulfill(\n                    status=200,\n                    headers={\n                        "Content-Type": "application/json",\n                        "X-Cache": "HIT"\n                    },\n                    body=json.dumps(cached_response)\n                )\n                return\n            \n            # \u751f\u6210\u65b0\u54cd\u5e94\u5e76\u7f13\u5b58\n            response_data = self._generate_cached_response(cache_key)\n            self.response_cache[cache_key] = response_data\n            \n            route.fulfill(\n                status=200,\n                headers={\n                    "Content-Type": "application/json",\n                    "X-Cache": "MISS"\n                },\n                body=json.dumps(response_data)\n            )\n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\noptimized_server = OptimizedMockServer()\npage.route("**/api/**", optimized_server.handle_route)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u5b9e\u9645\u5e94\u7528\u573a\u666f",children:"\u5b9e\u9645\u5e94\u7528\u573a\u666f"}),"\n",(0,r.jsx)(e.h3,{id:"1-\u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\u6a21\u62df",children:"1. \u5b8c\u6574\u7684\u6d4b\u8bd5\u73af\u5883\u6a21\u62df"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'class TestEnvironmentSimulator:\n    def __init__(self, config_file="test_config.json"):\n        self.config = self._load_config(config_file)\n        self.setup_test_data()\n    \n    def _load_config(self, config_file):\n        # \u52a0\u8f7d\u6d4b\u8bd5\u914d\u7f6e\n        default_config = {\n            "api_delay": 0,\n            "error_rate": 0,\n            "features": {\n                "user_management": True,\n                "analytics": True,\n                "notifications": False\n            }\n        }\n        return default_config\n    \n    def setup_test_data(self):\n        # \u8bbe\u7f6e\u6d4b\u8bd5\u6570\u636e\n        pass\n    \n    def handle_route(self, route, request):\n        # \u6839\u636e\u914d\u7f6e\u6a21\u62df\u4e0d\u540c\u7684\u73af\u5883\u884c\u4e3a\n        url = request.url\n        \n        # \u6dfb\u52a0\u5ef6\u8fdf\uff08\u5982\u679c\u914d\u7f6e\u4e86\uff09\n        if self.config["api_delay"] > 0:\n            time.sleep(self.config["api_delay"] / 1000.0)\n        \n        # \u6a21\u62df\u9519\u8bef\uff08\u6839\u636e\u9519\u8bef\u7387\uff09\n        if random.random() < self.config["error_rate"]:\n            route.fulfill(\n                status=500,\n                headers={"Content-Type": "application/json"},\n                body=\'{"error": "Simulated random error"}\'\n            )\n            return\n        \n        # \u6839\u636e\u529f\u80fd\u5f00\u5173\u8fd4\u56de\u4e0d\u540c\u7684\u54cd\u5e94\n        if "/api/features" in url:\n            route.fulfill(\n                status=200,\n                headers={"Content-Type": "application/json"},\n                body=json.dumps(self.config["features"])\n            )\n        else:\n            route.continue_()\n\n# \u4f7f\u7528\u793a\u4f8b\ntest_env = TestEnvironmentSimulator()\npage.route("**/*", test_env.handle_route)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u54cd\u5e94\u5b8c\u6574\u6027"}),"\uff1a\u4f7f\u7528 ",(0,r.jsx)(e.code,{children:"fulfill()"})," \u65f6\u5fc5\u987b\u63d0\u4f9b\u5b8c\u6574\u7684\u54cd\u5e94\uff0c\u5305\u62ec\u72b6\u6001\u7801\u548c\u9002\u5f53\u7684\u5934\u90e8"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5185\u5bb9\u7c7b\u578b"}),"\uff1a\u786e\u4fdd\u8bbe\u7f6e\u6b63\u786e\u7684 ",(0,r.jsx)(e.code,{children:"Content-Type"})," \u5934\u90e8"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5b57\u7b26\u7f16\u7801"}),"\uff1a\u5904\u7406\u975eASCII\u5b57\u7b26\u65f6\u6ce8\u610f\u7f16\u7801\u95ee\u9898"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u5185\u5b58\u4f7f\u7528"}),"\uff1a\u5927\u91cf\u4f7f\u7528\u7f13\u5b58\u65f6\u6ce8\u610f\u5185\u5b58\u6d88\u8017"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6d4b\u8bd5\u9694\u79bb"}),"\uff1a\u786e\u4fdd\u4e0d\u540c\u6d4b\u8bd5\u4e4b\u95f4\u7684\u6a21\u62df\u6570\u636e\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"\u6027\u80fd\u5f71\u54cd"}),"\uff1a\u590d\u6742\u7684\u54cd\u5e94\u751f\u6210\u903b\u8f91\u53ef\u80fd\u5f71\u54cd\u6d4b\u8bd5\u6027\u80fd"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.code,{children:"route.fulfill()"})," \u662f\u4e00\u4e2a\u975e\u5e38\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u901a\u8fc7\u5408\u7406\u4f7f\u7528\u53ef\u4ee5\u521b\u5efa\u5b8c\u5168\u53ef\u63a7\u7684\u6d4b\u8bd5\u73af\u5883\uff0c\u63d0\u9ad8\u6d4b\u8bd5\u7684\u53ef\u9760\u6027\u548c\u72ec\u7acb\u6027\u3002"]})]})}function c(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}}}]);