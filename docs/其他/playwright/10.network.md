---
id: intro10
permalink: /pw/intro10
title: 'ğŸ’œç½‘ç»œåŠŸèƒ½'
---

# Playwright Python ç½‘ç»œåŠŸèƒ½æ–‡æ¡£
## ä¸€ã€ç®€ä»‹
Playwright æä¾›äº†ç”¨äº**ç›‘æ§**å’Œ**ä¿®æ”¹**æµè§ˆå™¨ç½‘ç»œæµé‡çš„ APIï¼Œæ”¯æŒ HTTP å’Œ HTTPS åè®®ã€‚é¡µé¢å‘èµ·çš„æ‰€æœ‰è¯·æ±‚ï¼ˆåŒ…æ‹¬ XHR å’Œ fetch è¯·æ±‚ï¼‰éƒ½å¯è¢«è·Ÿè¸ªã€ä¿®æ”¹å’Œå¤„ç†ã€‚

æ­¤å¤–ï¼ŒPlaywright è¿˜æ”¯æŒç½‘ç»œç›¸å…³çš„æ‰©å±•èƒ½åŠ›ï¼Œå…·ä½“å¯å‚è€ƒï¼š
- [API æ¨¡æ‹ŸæŒ‡å—](https://playwright.net.cn/python/docs/mock)ï¼šäº†è§£å¦‚ä½•æ¨¡æ‹Ÿ API è¯·æ±‚ï¼ˆæ— éœ€å®é™…å‘èµ·è¯·æ±‚ï¼‰ã€æ‰§è¡Œ API è¯·æ±‚å¹¶ä¿®æ”¹å“åº”ã€ä½¿ç”¨ HAR æ–‡ä»¶æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚ã€‚
- [WebSocket å¤„ç†](#å…«ã€WebSockets)ï¼šå¼€ç®±å³ç”¨åœ°æ”¯æŒ WebSocket æ£€æŸ¥ã€æ¨¡æ‹Ÿå’Œä¿®æ”¹ã€‚


## äºŒã€HTTP è®¤è¯
é€šè¿‡é…ç½®æµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼ˆBrowserContextï¼‰çš„ `http_credentials` å‚æ•°ï¼Œå¯è‡ªåŠ¨å¤„ç†éœ€è¦ HTTP è®¤è¯çš„é¡µé¢è®¿é—®ã€‚

### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# åˆ›å»ºå¸¦æœ‰ HTTP è®¤è¯ä¿¡æ¯çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡
context = browser.new_context(
    http_credentials={"username": "bill", "password": "pa55w0rd"}
)
# ä»ä¸Šä¸‹æ–‡åˆ›å»ºæ–°é¡µé¢
page = context.new_page()
# å¯¼èˆªåˆ°éœ€è¦è®¤è¯çš„é¡µé¢ï¼ˆä¼šè‡ªåŠ¨ä½¿ç”¨é…ç½®çš„ç”¨æˆ·åå’Œå¯†ç ï¼‰
page.goto("https://example.com")
```

### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥åˆ›å»ºå¸¦æœ‰ HTTP è®¤è¯ä¿¡æ¯çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡
context = await browser.new_context(
    http_credentials={"username": "bill", "password": "pa55w0rd"}
)
# å¼‚æ­¥ä»ä¸Šä¸‹æ–‡åˆ›å»ºæ–°é¡µé¢
page = await context.new_page()
# å¼‚æ­¥å¯¼èˆªåˆ°éœ€è¦è®¤è¯çš„é¡µé¢
await page.goto("https://example.com")
```


## ä¸‰ã€HTTP ä»£ç†
Playwright æ”¯æŒä¸ºæµè§ˆå™¨é…ç½® HTTP(S) ä»£ç†æˆ– SOCKSv5 ä»£ç†ï¼Œå¯é€šè¿‡ä¸¤ç§æ–¹å¼è®¾ç½®ï¼š
1. **å…¨å±€ä»£ç†**ï¼šä¸ºæ•´ä¸ªæµè§ˆå™¨å®ä¾‹è®¾ç½®ï¼Œæ‰€æœ‰ä¸Šä¸‹æ–‡å…±äº«ä»£ç†é…ç½®ï¼›
2. **ä¸Šä¸‹æ–‡ä»£ç†**ï¼šä¸ºå•ä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡è®¾ç½®ï¼Œä»…å½“å‰ä¸Šä¸‹æ–‡ç”Ÿæ•ˆã€‚

åŒæ—¶ï¼Œå¯æŒ‡å®šä»£ç†çš„ç”¨æˆ·å/å¯†ç ï¼Œæˆ–é…ç½®æ— éœ€é€šè¿‡ä»£ç†çš„ä¸»æœºï¼ˆç»•è¿‡ä»£ç†ï¼‰ã€‚

### 1. å…¨å±€ä»£ç†é…ç½®
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# å¯åŠ¨ Chromium æµè§ˆå™¨æ—¶é…ç½®å…¨å±€ä»£ç†
browser = chromium.launch(proxy={
    "server": "http://myproxy.com:3128",  # ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ˆæ ¼å¼ï¼šåè®®://åœ°å€:ç«¯å£ï¼‰
    "username": "usr",  # ä»£ç†ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰
    "password": "pwd"   # ä»£ç†å¯†ç ï¼ˆå¯é€‰ï¼‰
})
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥å¯åŠ¨ Chromium æµè§ˆå™¨æ—¶é…ç½®å…¨å±€ä»£ç†
browser = await chromium.launch(proxy={
    "server": "http://myproxy.com:3128",
    "username": "usr",
    "password": "pwd"
})
```

### 2. ä¸Šä¸‹æ–‡ä»£ç†é…ç½®
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# å…ˆå¯åŠ¨æ— ä»£ç†çš„æµè§ˆå™¨å®ä¾‹
browser = chromium.launch()
# ä¸ºå•ä¸ªä¸Šä¸‹æ–‡é…ç½®ä»£ç†ï¼ˆä»…å½“å‰ä¸Šä¸‹æ–‡ä½¿ç”¨è¯¥ä»£ç†ï¼‰
context = browser.new_context(proxy={"server": "http://myproxy.com:3128"})
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥å¯åŠ¨æ— ä»£ç†çš„æµè§ˆå™¨å®ä¾‹
browser = await chromium.launch()
# å¼‚æ­¥ä¸ºå•ä¸ªä¸Šä¸‹æ–‡é…ç½®ä»£ç†
context = await browser.new_context(proxy={"server": "http://myproxy.com:3128"})
```


## å››ã€ç½‘ç»œäº‹ä»¶ç›‘æ§
Playwright å¯ç›‘æ§é¡µé¢çš„**è¯·æ±‚ï¼ˆrequestï¼‰** å’Œ**å“åº”ï¼ˆresponseï¼‰** äº‹ä»¶ï¼Œä¹Ÿå¯ç­‰å¾…ç‰¹å®šå“åº”å®Œæˆï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®åç­‰å¾… API å“åº”ï¼‰ã€‚

### 1. ç›‘æ§æ‰€æœ‰è¯·æ±‚ä¸å“åº”
é€šè¿‡ `page.on("request")` å’Œ `page.on("response")` è®¢é˜…äº‹ä»¶ï¼Œå®æ—¶æ‰“å°è¯·æ±‚æ–¹æ³•/URLã€å“åº”çŠ¶æ€ç /URLã€‚

#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
from playwright.sync_api import sync_playwright, Playwright

def run(playwright: Playwright):
    chromium = playwright.chromium
    # å¯åŠ¨æµè§ˆå™¨ï¼ˆé»˜è®¤æ— å¤´æ¨¡å¼ï¼‰
    browser = chromium.launch()
    page = browser.new_page()
    
    # è®¢é˜…è¯·æ±‚äº‹ä»¶ï¼šæ‰“å°è¯·æ±‚æ–¹æ³•å’Œ URL
    page.on("request", lambda request: print(">>", request.method, request.url))
    # è®¢é˜…å“åº”äº‹ä»¶ï¼šæ‰“å°å“åº”çŠ¶æ€ç å’Œ URL
    page.on("response", lambda response: print("<<", response.status, response.url))
    
    # å¯¼èˆªåˆ°ç›®æ ‡é¡µé¢ï¼Œè§¦å‘ç½‘ç»œäº‹ä»¶
    page.goto("https://example.com")
    # å…³é—­æµè§ˆå™¨
    browser.close()

# åˆå§‹åŒ– Playwright å¹¶æ‰§è¡Œ
with sync_playwright() as playwright:
    run(playwright)
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
import asyncio
from playwright.async_api import async_playwright, Playwright

async def run(playwright: Playwright):
    chromium = playwright.chromium
    # å¼‚æ­¥å¯åŠ¨æµè§ˆå™¨
    browser = await chromium.launch()
    page = await browser.new_page()
    
    # è®¢é˜…è¯·æ±‚å’Œå“åº”äº‹ä»¶
    page.on("request", lambda request: print(">>", request.method, request.url))
    page.on("response", lambda response: print("<<", response.status, response.url))
    
    # å¼‚æ­¥å¯¼èˆªåˆ°ç›®æ ‡é¡µé¢
    await page.goto("https://example.com")
    # å¼‚æ­¥å…³é—­æµè§ˆå™¨
    await browser.close()

async def main():
    # å¼‚æ­¥åˆå§‹åŒ– Playwright å¹¶æ‰§è¡Œ
    async with async_playwright() as playwright:
        await run(playwright)

# è¿è¡Œå¼‚æ­¥ä¸»å‡½æ•°
asyncio.run(main())
```

### 2. ç­‰å¾…ç‰¹å®šå“åº”
é€šè¿‡ `page.expect_response()` ç­‰å¾…ç¬¦åˆæ¡ä»¶çš„å“åº”ï¼ˆå¦‚ç‚¹å‡»æŒ‰é’®åè§¦å‘çš„ API è¯·æ±‚ï¼‰ï¼Œæ”¯æŒä¸‰ç§åŒ¹é…æ–¹å¼ï¼š
- Glob è·¯å¾„æ¨¡å¼ï¼ˆå¦‚ `**/api/fetch_data`ï¼‰ï¼›
- æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¦‚ `re.compile(r"\.jpeg$")`ï¼‰ï¼›
- è‡ªå®šä¹‰æ–­è¨€å‡½æ•°ï¼ˆå¦‚åˆ¤æ–­ URL åŒ…å«ç‰¹å®štokenï¼‰ã€‚

#### æ–¹å¼1ï¼šGlob è·¯å¾„æ¨¡å¼åŒ¹é…
##### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# ç­‰å¾… URL åŒ¹é… "**/api/fetch_data" çš„å“åº”ï¼ˆ** è¡¨ç¤ºä»»æ„å±‚çº§è·¯å¾„ï¼‰
with page.expect_response("**/api/fetch_data") as response_info:
    # è§¦å‘è¯·æ±‚ï¼ˆå¦‚ç‚¹å‡»â€œæ›´æ–°â€æŒ‰é’®ï¼‰
    page.get_by_text("Update").click()
# è·å–å“åº”å¯¹è±¡
response = response_info.value
```

##### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥ç­‰å¾… URL åŒ¹é… "**/api/fetch_data" çš„å“åº”
async with page.expect_response("**/api/fetch_data") as response_info:
    # å¼‚æ­¥è§¦å‘è¯·æ±‚
    await page.get_by_text("Update").click()
# å¼‚æ­¥è·å–å“åº”å¯¹è±¡
response = await response_info.value
```

#### æ–¹å¼2ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
##### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
import re

# ç­‰å¾… URL ä»¥ .jpeg ç»“å°¾çš„å“åº”ï¼ˆæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼‰
with page.expect_response(re.compile(r"\.jpeg$")) as response_info:
    page.get_by_text("Update").click()
response = response_info.value
```

##### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
import re

# å¼‚æ­¥ç­‰å¾… URL ä»¥ .jpeg ç»“å°¾çš„å“åº”
async with page.expect_response(re.compile(r"\.jpeg$")) as response_info:
    await page.get_by_text("Update").click()
response = await response_info.value
```

#### æ–¹å¼3ï¼šè‡ªå®šä¹‰æ–­è¨€å‡½æ•°åŒ¹é…
##### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
token = "user123"  # å‡è®¾éœ€è¦åŒ¹é…çš„ token

# ç­‰å¾… URL åŒ…å«æŒ‡å®š token çš„å“åº”ï¼ˆè‡ªå®šä¹‰æ–­è¨€å‡½æ•°ï¼‰
with page.expect_response(lambda response: token in response.url) as response_info:
    page.get_by_text("Update").click()
response = response_info.value
```

##### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
token = "user123"

# å¼‚æ­¥ç­‰å¾… URL åŒ…å«æŒ‡å®š token çš„å“åº”
async with page.expect_response(lambda response: token in response.url) as response_info:
    await page.get_by_text("Update").click()
response = await response_info.value
```


## äº”ã€å¤„ç†è¯·æ±‚ï¼ˆæ¨¡æ‹Ÿ API ç«¯ç‚¹ï¼‰
é€šè¿‡ `page.route()` æˆ– `context.route()` æ‹¦æˆªç‰¹å®šè¯·æ±‚ï¼Œå¹¶è‡ªå®šä¹‰å“åº”å†…å®¹ï¼ˆå¦‚æ¨¡æ‹Ÿ API æˆåŠŸ/å¤±è´¥çŠ¶æ€ï¼‰ï¼Œæ— éœ€å®é™…å‘èµ·åç«¯è¯·æ±‚ã€‚

- `page.route()`ï¼šä»…å¯¹å½“å‰é¡µé¢ç”Ÿæ•ˆï¼ŒåŒ…æ‹¬é¡µé¢å¼¹å‡ºçš„çª—å£å’Œé“¾æ¥ï¼›
- `context.route()`ï¼šå¯¹æ•´ä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ç”Ÿæ•ˆï¼Œæ‰€æœ‰ä»è¯¥ä¸Šä¸‹æ–‡åˆ›å»ºçš„é¡µé¢å…±äº«è·¯ç”±è§„åˆ™ã€‚

### 1. é¡µé¢çº§è·¯ç”±ï¼ˆpage.route()ï¼‰
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# å®šä¹‰æµ‹è¯•æ•°æ®ï¼ˆæ¨¡æ‹Ÿ API å“åº”ä½“ï¼‰
test_data = '{"status": "success", "data": [1, 2, 3]}'

# æ‹¦æˆª URL åŒ¹é… "**/api/fetch_data" çš„è¯·æ±‚ï¼Œè¿”å›è‡ªå®šä¹‰å“åº”
page.route(
    "**/api/fetch_data",  # åŒ¹é…è§„åˆ™ï¼ˆGlob æ¨¡å¼ï¼‰
    lambda route: route.fulfill(  # è‡ªå®šä¹‰å“åº”
        status=200,  # å“åº”çŠ¶æ€ç 
        body=test_data,  # å“åº”ä½“
        headers={"Content-Type": "application/json"}  # å“åº”å¤´ï¼ˆå¯é€‰ï¼‰
    )
)
# å¯¼èˆªåˆ°é¡µé¢ï¼Œè§¦å‘æ‹¦æˆªçš„è¯·æ±‚
page.goto("https://example.com")
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
test_data = '{"status": "success", "data": [1, 2, 3]}'

# å¼‚æ­¥æ‹¦æˆªè¯·æ±‚å¹¶è¿”å›è‡ªå®šä¹‰å“åº”
await page.route(
    "**/api/fetch_data",
    lambda route: route.fulfill(status=200, body=test_data, headers={"Content-Type": "application/json"})
)
# å¼‚æ­¥å¯¼èˆªåˆ°é¡µé¢
await page.goto("https://example.com")
```

### 2. ä¸Šä¸‹æ–‡çº§è·¯ç”±ï¼ˆcontext.route()ï¼‰
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# æ‹¦æˆªæ•´ä¸ªä¸Šä¸‹æ–‡å†… URL åŒ¹é… "**/api/login" çš„è¯·æ±‚
context.route(
    "**/api/login",
    lambda route: route.fulfill(status=200, body="accept")  # æ¨¡æ‹Ÿç™»å½•æˆåŠŸå“åº”
)
# ä»ä¸Šä¸‹æ–‡åˆ›å»ºé¡µé¢å¹¶å¯¼èˆª
page = context.new_page()
page.goto("https://example.com")
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥æ‹¦æˆªä¸Šä¸‹æ–‡å†…çš„ç™»å½•è¯·æ±‚
await context.route(
    "**/api/login",
    lambda route: route.fulfill(status=200, body="accept")
)
# å¼‚æ­¥åˆ›å»ºé¡µé¢å¹¶å¯¼èˆª
page = await context.new_page()
await page.goto("https://example.com")
```


## å…­ã€ä¿®æ”¹è¯·æ±‚
é€šè¿‡ `route.continue_()` æ–¹æ³•ï¼Œå¯åœ¨æ‹¦æˆªè¯·æ±‚åä¿®æ”¹è¯·æ±‚å‚æ•°ï¼ˆå¦‚è¯·æ±‚å¤´ã€è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚ä½“ç­‰ï¼‰ï¼Œå†ç»§ç»­å‘èµ·è¯·æ±‚ã€‚

### ç¤ºä¾‹1ï¼šåˆ é™¤è¯·æ±‚å¤´
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# å®šä¹‰è·¯ç”±å¤„ç†å‡½æ•°ï¼šåˆ é™¤è¯·æ±‚å¤´ä¸­çš„ "x-secret" å­—æ®µ
def handle_route(route):
    # è·å–åŸå§‹è¯·æ±‚å¤´
    headers = route.request.headers
    # åˆ é™¤æ•æ„Ÿå¤´ä¿¡æ¯
    if "x-secret" in headers:
        del headers["x-secret"]
    # ç»§ç»­å‘èµ·è¯·æ±‚ï¼ˆä½¿ç”¨ä¿®æ”¹åçš„è¯·æ±‚å¤´ï¼‰
    route.continue_(headers=headers)

# æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆ**/* åŒ¹é…æ‰€æœ‰ URLï¼‰ï¼Œåº”ç”¨å¤„ç†å‡½æ•°
page.route("**/*", handle_route)
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥å®šä¹‰è·¯ç”±å¤„ç†å‡½æ•°
async def handle_route(route):
    headers = route.request.headers
    if "x-secret" in headers:
        del headers["x-secret"]
    # å¼‚æ­¥ç»§ç»­å‘èµ·è¯·æ±‚
    await route.continue_(headers=headers)

# å¼‚æ­¥æ‹¦æˆªæ‰€æœ‰è¯·æ±‚å¹¶åº”ç”¨å¤„ç†å‡½æ•°
await page.route("**/*", handle_route)
```

### ç¤ºä¾‹2ï¼šä¿®æ”¹è¯·æ±‚æ–¹æ³•
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œå°†è¯·æ±‚æ–¹æ³•æ”¹ä¸º POST
page.route("**/*", lambda route: route.continue_(method="POST"))
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œä¿®æ”¹è¯·æ±‚æ–¹æ³•ä¸º POST
await page.route("**/*", lambda route: route.continue_(method="POST"))
```


## ä¸ƒã€ä¸­æ­¢è¯·æ±‚
é€šè¿‡ `route.abort()` æ–¹æ³•ï¼Œå¯æ‹¦æˆªç‰¹å®šè¯·æ±‚å¹¶ç›´æ¥ä¸­æ­¢ï¼ˆä¸å‘èµ·å®é™…è¯·æ±‚ï¼‰ï¼Œé€‚ç”¨äºå±è”½ä¸å¿…è¦çš„èµ„æºï¼ˆå¦‚å›¾ç‰‡ã€å¹¿å‘Šç­‰ï¼‰ã€‚

### ç¤ºä¾‹1ï¼šä¸­æ­¢å›¾ç‰‡è¯·æ±‚ï¼ˆæŒ‰æ–‡ä»¶åç¼€ï¼‰
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# æ‹¦æˆªæ‰€æœ‰åç¼€ä¸º png/jpg/jpeg çš„è¯·æ±‚ï¼Œç›´æ¥ä¸­æ­¢ï¼ˆä¸åŠ è½½å›¾ç‰‡ï¼‰
page.route("**/*.{png,jpg,jpeg}", lambda route: route.abort())
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥æ‹¦æˆªå›¾ç‰‡è¯·æ±‚å¹¶ä¸­æ­¢
await page.route("**/*.{png,jpg,jpeg}", lambda route: route.abort())
```

### ç¤ºä¾‹2ï¼šæŒ‰èµ„æºç±»å‹ä¸­æ­¢è¯·æ±‚
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼šè‹¥èµ„æºç±»å‹ä¸º "image" åˆ™ä¸­æ­¢ï¼Œå¦åˆ™ç»§ç»­
page.route(
    "**/*",
    lambda route: route.abort() if route.request.resource_type == "image" else route.continue_()
)
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å¼‚æ­¥æ‹¦æˆªè¯·æ±‚ï¼ŒæŒ‰èµ„æºç±»å‹åˆ¤æ–­æ˜¯å¦ä¸­æ­¢
await page.route(
    "**/*",
    lambda route: route.abort() if route.request.resource_type == "image" else route.continue_()
)
```


## å…«ã€ä¿®æ”¹å“åº”
é€šè¿‡ `route.fetch()` å…ˆè·å–åŸå§‹å“åº”ï¼Œä¿®æ”¹å“åº”å†…å®¹ï¼ˆå¦‚å“åº”ä½“ã€å“åº”å¤´ï¼‰åï¼Œå†é€šè¿‡ `route.fulfill()` è¿”å›è‡ªå®šä¹‰å“åº”ç»™é¡µé¢ã€‚

### ç¤ºä¾‹ï¼šä¿®æ”¹é¡µé¢æ ‡é¢˜ï¼ˆæ·»åŠ å‰ç¼€ï¼‰
#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
from playwright.sync_api import Route

def handle_route(route: Route) -> None:
    # 1. è·å–åŸå§‹å“åº”ï¼ˆä¸ç›´æ¥è¿”å›ç»™é¡µé¢ï¼‰
    response = route.fetch()
    # 2. ä¿®æ”¹å“åº”ä½“ï¼šåœ¨ <title> æ ‡ç­¾å‰æ·»åŠ å‰ç¼€
    body = response.text()  # è·å–åŸå§‹å“åº”ä½“ï¼ˆæ–‡æœ¬æ ¼å¼ï¼‰
    modified_body = body.replace("<title>", "<title>My prefix:")  # ä¿®æ”¹æ ‡é¢˜
    # 3. è¿”å›è‡ªå®šä¹‰å“åº”ï¼ˆå¤ç”¨åŸå§‹å“åº”çš„å¤§éƒ¨åˆ†å‚æ•°ï¼Œä»…è¦†ç›– body å’Œ headersï¼‰
    route.fulfill(
        response=response,  # å¤ç”¨åŸå§‹å“åº”çš„çŠ¶æ€ç ã€å¤§éƒ¨åˆ†å¤´ä¿¡æ¯ç­‰
        body=modified_body,  # è¦†ç›–å“åº”ä½“ï¼ˆä½¿ç”¨ä¿®æ”¹åçš„å†…å®¹ï¼‰
        headers={**response.headers, "content-type": "text/html"}  # å¼ºåˆ¶è®¾ç½® Content-Type ä¸º html
    )

# æ‹¦æˆª URL åŒ¹é… "**/title.html" çš„è¯·æ±‚ï¼Œåº”ç”¨å“åº”ä¿®æ”¹é€»è¾‘
page.route("**/title.html", handle_route)
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
from playwright.async_api import Route

async def handle_route(route: Route) -> None:
    # 1. å¼‚æ­¥è·å–åŸå§‹å“åº”
    response = await route.fetch()
    # 2. å¼‚æ­¥è·å–å“åº”ä½“å¹¶ä¿®æ”¹
    body = await response.text()
    modified_body = body.replace("<title>", "<title>My prefix:")
    # 3. å¼‚æ­¥è¿”å›è‡ªå®šä¹‰å“åº”
    await route.fulfill(
        response=response,
        body=modified_body,
        headers={**response.headers, "content-type": "text/html"}
    )

# å¼‚æ­¥æ‹¦æˆªè¯·æ±‚å¹¶åº”ç”¨å“åº”ä¿®æ”¹é€»è¾‘
await page.route("**/title.html", handle_route)
```


## ä¹ã€Glob URL æ¨¡å¼
Playwright çš„ç½‘ç»œæ‹¦æˆªæ–¹æ³•ï¼ˆå¦‚ `page.route()`ã€`page.expect_response()`ï¼‰ä½¿ç”¨**ç®€åŒ–çš„ Glob æ¨¡å¼**åŒ¹é… URLï¼Œæ”¯æŒä»¥ä¸‹é€šé…ç¬¦è§„åˆ™ï¼š

| é€šé…ç¬¦ | åŠŸèƒ½æè¿° |
|--------|----------|
| `*`    | åŒ¹é…é™¤ `/` å¤–çš„ä»»æ„å­—ç¬¦ï¼ˆå•å±‚çº§ï¼‰ |
| `**`   | åŒ¹é…åŒ…æ‹¬ `/` åœ¨å†…çš„ä»»æ„å­—ç¬¦ï¼ˆå¤šå±‚çº§ï¼Œå¦‚è·¨ç›®å½•ï¼‰ |
| `?`    | ä»…åŒ¹é…å­—é¢é‡ `?`ï¼ˆä¸åŒ¹é…å…¶ä»–å­—ç¬¦ï¼ŒåŒ¹é…ä»»æ„å­—ç¬¦éœ€ç”¨ `*`ï¼‰ |
| `{}`   | åŒ¹é…æ‹¬å·å†…ç”¨é€—å·åˆ†éš”çš„é€‰é¡¹åˆ—è¡¨ï¼ˆå¦‚ `{png,jpg}` åŒ¹é… png æˆ– jpgï¼‰ |
| `\`    | è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `\*` åŒ¹é…å­—é¢é‡ `*`ï¼Œæ³¨æ„åœ¨ä»£ç ä¸­éœ€å†™ä¸º `\\*`ï¼‰ |

### ç¤ºä¾‹ä¸è¯´æ˜
| Glob æ¨¡å¼ | åŒ¹é…ç»“æœ | ä¸åŒ¹é…ç»“æœ |
|-----------|----------|------------|
| `https://example.com/*.js` | `https://example.com/file.js`ï¼ˆå•å±‚çº§ JS æ–‡ä»¶ï¼‰ | `https://example.com/path/file.js`ï¼ˆå¤šå±‚çº§ï¼‰ |
| `https://example.com/?page=1` | `https://example.com/?page=1`ï¼ˆå«æŒ‡å®šæŸ¥è¯¢å‚æ•°ï¼‰ | `https://example.com`ï¼ˆæ— æŸ¥è¯¢å‚æ•°ï¼‰ |
| `**/*.js` | `https://example.com/file.js`ã€`https://example.com/path/file.js`ï¼ˆä»»æ„å±‚çº§ JS æ–‡ä»¶ï¼‰ | - |
| `**/*.{png,jpg,jpeg}` | æ‰€æœ‰åç¼€ä¸º pngã€jpgã€jpeg çš„æ–‡ä»¶ï¼ˆå¦‚ `https://a.com/img.png`ï¼‰ | `https://a.com/img.gif`ï¼ˆå…¶ä»–åç¼€ï¼‰ |

### é‡è¦æ³¨æ„äº‹é¡¹
1. Glob æ¨¡å¼å¿…é¡»åŒ¹é…**å®Œæ•´ URL**ï¼ˆåŒ…æ‹¬åè®®ã€åŸŸåã€è·¯å¾„ï¼‰ï¼Œè€Œééƒ¨åˆ†ç‰‡æ®µï¼›
2. å¤æ‚åŒ¹é…åœºæ™¯ï¼ˆå¦‚åŠ¨æ€å‚æ•°ã€å¤šæ¡ä»¶ç»„åˆï¼‰å»ºè®®ä½¿ç”¨ **æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegExpï¼‰** æ›¿ä»£ Glob æ¨¡å¼ï¼›
3. åŒ¹é…æ—¶éœ€æ³¨æ„ URL çš„å¤§å°å†™ï¼ˆGlob æ¨¡å¼é»˜è®¤åŒºåˆ†å¤§å°å†™ï¼‰ã€‚


## åã€WebSockets
Playwright åŸç”Ÿæ”¯æŒ WebSocket çš„**æ£€æŸ¥ã€æ¨¡æ‹Ÿå’Œä¿®æ”¹**ï¼Œå…·ä½“æ¨¡æ‹Ÿæ–¹æ³•å¯å‚è€ƒ [API æ¨¡æ‹ŸæŒ‡å—](https://playwright.net.cn/python/docs/mock)ã€‚

### ç›‘æ§ WebSocket äº‹ä»¶
é€šè¿‡ `page.on("websocket")` è®¢é˜… WebSocket åˆ›å»ºäº‹ä»¶ï¼Œå¯è¿›ä¸€æ­¥ç›‘æ§ WebSocket çš„**å‘é€å¸§ï¼ˆframesentï¼‰**ã€**æ¥æ”¶å¸§ï¼ˆframereceivedï¼‰** å’Œ**å…³é—­ï¼ˆcloseï¼‰** äº‹ä»¶ã€‚

#### åŒæ­¥ä»£ç ç¤ºä¾‹ï¼ˆSyncï¼‰
```python
# å®šä¹‰ WebSocket å¤„ç†å‡½æ•°
def on_web_socket(ws):
    # WebSocket è¿æ¥æ‰“å¼€æ—¶æ‰“å° URL
    print(f"WebSocket opened: {ws.url}")
    
    # ç›‘æ§å‘é€å¸§äº‹ä»¶ï¼šæ‰“å°å‘é€çš„ payload
    ws.on("framesent", lambda payload: print(f"Sent frame: {payload}"))
    
    # ç›‘æ§æ¥æ”¶å¸§äº‹ä»¶ï¼šæ‰“å°æ¥æ”¶çš„ payload
    ws.on("framereceived", lambda payload: print(f"Received frame: {payload}"))
    
    # ç›‘æ§å…³é—­äº‹ä»¶
    ws.on("close", lambda: print("WebSocket closed"))

# è®¢é˜… WebSocket åˆ›å»ºäº‹ä»¶
page.on("websocket", on_web_socket)
```

#### å¼‚æ­¥ä»£ç ç¤ºä¾‹ï¼ˆAsyncï¼‰
```python
# å®šä¹‰ WebSocket å¤„ç†å‡½æ•°ï¼ˆå¼‚æ­¥åœºæ™¯ä¸‹é€»è¾‘ä¸åŒæ­¥ä¸€è‡´ï¼Œæ— éœ€ awaitï¼‰
def on_web_socket(ws):
    print(f"WebSocket opened: {ws.url}")
    ws.on("framesent", lambda payload: print(f"Sent frame: {payload}"))
    ws.on("framereceived", lambda payload: print(f"Received frame: {payload}"))
    ws.on("close", lambda: print("WebSocket closed"))

# è®¢é˜… WebSocket åˆ›å»ºäº‹ä»¶
page.on("websocket", on_web_socket)
```


## åä¸€ã€ä¸¢å¤±çš„ç½‘ç»œäº‹ä»¶ä¸æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼ˆService Workersï¼‰
è‹¥ä½¿ç”¨ `browser_context.route()` æˆ– `page.route()` æ—¶å‘ç°**ç½‘ç»œäº‹ä»¶ä¸¢å¤±**ï¼Œå¯èƒ½æ˜¯æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼ˆService Workersï¼‰æ¥ç®¡äº†ç½‘ç»œè¯·æ±‚å¯¼è‡´ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³ï¼š

### 1. ç¦ç”¨ Service Workers
åœ¨åˆ›å»ºæµè§ˆå™¨ä¸Šä¸‹æ–‡æ—¶ï¼Œå°† `service_workers` è®¾ç½®ä¸º `'block'`ï¼Œé˜»æ­¢ Service Workers è¿è¡Œï¼š
```python
# åŒæ­¥ç¤ºä¾‹ï¼šåˆ›å»ºç¦ç”¨ Service Workers çš„ä¸Šä¸‹æ–‡
context = browser.new_context(service_workers='block')

# å¼‚æ­¥ç¤ºä¾‹
context = await browser.new_context(service_workers='block')
```

### 2. é¿å…ä¸ç¬¬ä¸‰æ–¹æ¨¡æ‹Ÿå·¥å…·å†²çª
è‹¥ä½¿ç”¨ Mock Service Worker (MSW) ç­‰ç¬¬ä¸‰æ–¹æ¨¡æ‹Ÿå·¥å…·ï¼Œå…¶ä¼šé€šè¿‡ Service Workers æ¥ç®¡è¯·æ±‚ï¼Œå¯¼è‡´ Playwright çš„ `route()` æ— æ³•æ•è·äº‹ä»¶ã€‚å»ºè®®ï¼š
- ä¼˜å…ˆä½¿ç”¨ Playwright å†…ç½®çš„ `browser_context.route()` æˆ– `page.route()` è¿›è¡Œå“åº”æ¨¡æ‹Ÿï¼›
- è‹¥éœ€åŒæ—¶ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œéœ€ç¡®ä¿å…¶ä¸å½±å“ Playwright çš„ç½‘ç»œæ‹¦æˆªé€»è¾‘ã€‚

### 3. ç›‘å¬ Service Workers å‘èµ·çš„è¯·æ±‚
è‹¥éœ€ç›‘æ§ Service Workers æœ¬èº«å‘èµ·çš„è¯·æ±‚ï¼Œå¯å‚è€ƒ Playwright çš„ [å®éªŒæ€§åŠŸèƒ½æ–‡æ¡£](https://playwright.dev/docs/service-workers)ï¼ˆéœ€æ³¨æ„å®éªŒæ€§åŠŸèƒ½å¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼‰ã€‚