---
id: intro12
title: 'ğŸ’œ12.Route'
---

# Playwright for Pythonï¼šRoute ç±»ä¸­æ–‡æ–‡æ¡£
å½“é€šè¿‡ `page.route()` æˆ– `browser_context.route()` è®¾ç½®ç½‘ç»œè·¯ç”±æ—¶ï¼Œ`Route` å¯¹è±¡å¯ç”¨äºå¤„ç†è¯¥è·¯ç”±çš„è¯·æ±‚ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å…¶æ–¹æ³•ã€å±æ€§åŠä½¿ç”¨ç¤ºä¾‹ã€‚

## ä¸€ã€æ ¸å¿ƒæ–¹æ³•
### 1. abort() - ç»ˆæ­¢è·¯ç”±è¯·æ±‚
ç»ˆæ­¢å½“å‰è·¯ç”±å¯¹åº”çš„ç½‘ç»œè¯·æ±‚ï¼Œå¯æŒ‡å®šé”™è¯¯ç ã€‚

#### ä½¿ç”¨æ–¹å¼
```python
route.abort()
route.abort(**kwargs)
```

#### å‚æ•°è¯´æ˜
- `error_code`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šé”™è¯¯ç ï¼Œé»˜è®¤å€¼ä¸º `failed`ï¼Œæ”¯æŒä»¥ä¸‹å–å€¼ï¼š
  - `'aborted'`ï¼šæ“ä½œè¢«ä¸­æ­¢ï¼ˆå› ç”¨æˆ·æ“ä½œï¼‰
  - `'accessdenied'`ï¼šè®¿é—®èµ„æºï¼ˆéç½‘ç»œç±»ï¼‰çš„æƒé™è¢«æ‹’ç»
  - `'addressunreachable'`ï¼šIP åœ°å€ä¸å¯è¾¾ï¼ˆé€šå¸¸è¡¨ç¤ºæ— æŒ‡å®šä¸»æœºæˆ–ç½‘ç»œçš„è·¯ç”±ï¼‰
  - `'blockedbyclient'`ï¼šå®¢æˆ·ç«¯ä¸»åŠ¨é˜»æ­¢è¯·æ±‚
  - `'blockedbyresponse'`ï¼šè¯·æ±‚å¤±è´¥ï¼ˆå› å“åº”åŒ…å«æœªæ»¡è¶³çš„è¦æ±‚ï¼Œå¦‚ `X-Frame-Options` æˆ– `Content-Security-Policy` ç¥–å…ˆæ£€æŸ¥ï¼‰
  - `'connectionaborted'`ï¼šè¿æ¥è¶…æ—¶ï¼ˆå‘é€æ•°æ®åæœªæ”¶åˆ° ACK å“åº”ï¼‰
  - `'connectionclosed'`ï¼šè¿æ¥è¢«å…³é—­ï¼ˆå¯¹åº” TCP FINï¼‰
  - `'connectionfailed'`ï¼šè¿æ¥å°è¯•å¤±è´¥
  - `'connectionrefused'`ï¼šè¿æ¥å°è¯•è¢«æ‹’ç»
  - `'connectionreset'`ï¼šè¿æ¥è¢«é‡ç½®ï¼ˆå¯¹åº” TCP RSTï¼‰
  - `'internetdisconnected'`ï¼šç½‘ç»œè¿æ¥ä¸¢å¤±
  - `'namenotresolved'`ï¼šä¸»æœºåæ— æ³•è§£æ
  - `'timedout'`ï¼šæ“ä½œè¶…æ—¶
  - `'failed'`ï¼šé€šç”¨å¤±è´¥ï¼ˆé»˜è®¤å€¼ï¼‰

#### è¿”å›å€¼
NoneTypeï¼ˆæ— è¿”å›å€¼ï¼‰

### 2. continue_() - ç»§ç»­è·¯ç”±è¯·æ±‚ï¼ˆå¯é€‰è¦†ç›–å‚æ•°ï¼‰
å°†è·¯ç”±è¯·æ±‚å‘é€è‡³ç½‘ç»œï¼Œæ”¯æŒå¯¹è¯·æ±‚å¤´ã€æ–¹æ³•ã€è¯·æ±‚ä½“ã€URL è¿›è¡Œè¦†ç›–ä¿®æ”¹ã€‚

#### ä½¿ç”¨ç¤ºä¾‹
**åŒæ­¥æ¨¡å¼**
```python
def handle(route, request):
    # è¦†ç›–è¯·æ±‚å¤´ï¼šæ·»åŠ  foo å¤´ã€åˆ é™¤ bar å¤´
    headers = {
        **request.headers,
        "foo": "foo-value",
        "bar": None
    }
    route.continue_(headers=headers)

page.route("**/*", handle)
```

**å¼‚æ­¥æ¨¡å¼**
```python
async def handle(route, request):
    # è¦†ç›–è¯·æ±‚å¤´ï¼šæ·»åŠ  foo å¤´ã€åˆ é™¤ bar å¤´
    headers = {
        **request.headers,
        "foo": "foo-value",
        "bar": None
    }
    await route.continue_(headers=headers)

await page.route("**/*", handle)
```

#### å‚æ•°è¯´æ˜
- `headers`ï¼ˆDict[str, str]ï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚çš„ HTTP å¤´ï¼Œå€¼ä¼šè‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²
- `method`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚æ–¹æ³•ï¼ˆå¦‚ GETã€POSTï¼‰
- `post_data`ï¼ˆstr | bytes | Dictï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚çš„ POST æ•°æ®
- `url`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚ URLï¼Œæ–° URL å¿…é¡»ä¸åŸ URL åè®®ä¸€è‡´

#### è¿”å›å€¼
NoneTypeï¼ˆæ— è¿”å›å€¼ï¼‰

#### æ³¨æ„äº‹é¡¹
- å¤´ä¿¡æ¯ï¼ˆheadersï¼‰çš„ä¿®æ”¹é€‚ç”¨äºå½“å‰è·¯ç”±è¯·æ±‚åŠåç»­é‡å®šå‘è¯·æ±‚ï¼›URLã€æ–¹æ³•ï¼ˆmethodï¼‰ã€POST æ•°æ®ä»…é€‚ç”¨äºåŸå§‹è¯·æ±‚ï¼Œä¸ä¼šä¼ é€’åˆ°é‡å®šå‘è¯·æ±‚ã€‚
- è°ƒç”¨åä¼šç«‹å³å°†è¯·æ±‚å‘é€è‡³ç½‘ç»œï¼Œåç»­åŒ¹é…çš„è·¯ç”±å¤„ç†å™¨ä¸ä¼šè¢«è§¦å‘ï¼›è‹¥éœ€è§¦å‘åç»­å¤„ç†å™¨ï¼Œéœ€ä½¿ç”¨ `route.fallback()`ã€‚
- æ— æ³•é€šè¿‡è¯¥æ–¹æ³•è¦†ç›– `Cookie` å¤´ï¼ˆå³ä½¿æŒ‡å®šä¹Ÿä¼šè¢«å¿½ç•¥ï¼ŒCookie ä»æµè§ˆå™¨ Cookie å­˜å‚¨ä¸­åŠ è½½ï¼‰ï¼›å¦‚éœ€è®¾ç½®è‡ªå®šä¹‰ Cookieï¼Œä½¿ç”¨ `browser_context.add_cookies()`ã€‚

### 3. fallback() -  fallback è·¯ç”±è¯·æ±‚ï¼ˆè§¦å‘åç»­å¤„ç†å™¨ï¼‰
ä¸ `continue_()` ç±»ä¼¼ï¼Œæ”¯æŒè¦†ç›–è¯·æ±‚å‚æ•°ï¼Œä½†ä¼šå…ˆè§¦å‘åç»­åŒ¹é…çš„è·¯ç”±å¤„ç†å™¨ï¼Œå†å°†è¯·æ±‚å‘é€è‡³ç½‘ç»œã€‚

#### ä½¿ç”¨åœºæ™¯
å½“å¤šä¸ªè·¯ç”±å¤„ç†å™¨åŒ¹é…åŒä¸€è¯·æ±‚æ—¶ï¼ŒæŒ‰æ³¨å†Œé¡ºåºåå‘æ‰§è¡Œï¼ˆæœ€åæ³¨å†Œçš„å…ˆæ‰§è¡Œï¼‰ã€‚é€‚ç”¨äºæŒ‰è¯·æ±‚ç±»å‹ï¼ˆå¦‚ API/é¡µé¢èµ„æºã€GET/POSTï¼‰æ‹†åˆ†å¤„ç†å™¨é€»è¾‘ã€‚

#### ä½¿ç”¨ç¤ºä¾‹
**å¤šè·¯ç”±å¤„ç†å™¨æ‰§è¡Œé¡ºåº**
```python
# åŒæ­¥æ¨¡å¼
page.route("**/*", lambda route: route.abort())  # æœ€åæ‰§è¡Œï¼ˆç»ˆæ­¢è¯·æ±‚ï¼‰
page.route("**/*", lambda route: route.fallback())  # ä¸­é—´æ‰§è¡Œï¼ˆfallback åˆ°ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼‰
page.route("**/*", lambda route: route.fallback())  # æœ€å…ˆæ‰§è¡Œï¼ˆfallback åˆ°ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼‰

# å¼‚æ­¥æ¨¡å¼
await page.route("**/*", lambda route: route.abort())  # æœ€åæ‰§è¡Œ
await page.route("**/*", lambda route: route.fallback())  # ä¸­é—´æ‰§è¡Œ
await page.route("**/*", lambda route: route.fallback())  # æœ€å…ˆæ‰§è¡Œ
```

**æŒ‰è¯·æ±‚æ–¹æ³•æ‹†åˆ†å¤„ç†å™¨**
```python
# åŒæ­¥æ¨¡å¼
# å¤„ç† GET è¯·æ±‚
def handle_get(route):
    if route.request.method != "GET":
        route.fallback()  # é GET è¯·æ±‚ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return
    # ä»…å¤„ç† GET è¯·æ±‚çš„é€»è¾‘
    # ...

# å¤„ç† POST è¯·æ±‚
def handle_post(route):
    if route.request.method != "POST":
        route.fallback()  # é POST è¯·æ±‚ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return
    # ä»…å¤„ç† POST è¯·æ±‚çš„é€»è¾‘
    # ...

page.route("**/*", handle_get)
page.route("**/*", handle_post)

# å¼‚æ­¥æ¨¡å¼
async def handle_get(route):
    if route.request.method != "GET":
        await route.fallback()
        return
    # ä»…å¤„ç† GET è¯·æ±‚çš„é€»è¾‘
    # ...

async def handle_post(route):
    if route.request.method != "POST":
        await route.fallback()
        return
    # ä»…å¤„ç† POST è¯·æ±‚çš„é€»è¾‘
    # ...

await page.route("**/*", handle_get)
await page.route("**/*", handle_post)
```

**fallback æ—¶ä¿®æ”¹è¯·æ±‚å‚æ•°**
```python
# åŒæ­¥æ¨¡å¼
def handle(route, request):
    headers = {
        **request.headers,
        "foo": "foo-value",  # æ·»åŠ å¤´
        "bar": None  # åˆ é™¤å¤´
    }
    route.fallback(headers=headers)

page.route("**/*", handle)

# å¼‚æ­¥æ¨¡å¼
async def handle(route, request):
    headers = {
        **request.headers,
        "foo": "foo-value",
        "bar": None
    }
    await route.fallback(headers=headers)

await page.route("**/*", handle)
```

#### å‚æ•°è¯´æ˜
ä¸ `continue_()` ä¸€è‡´ï¼š`headers`ã€`method`ã€`post_data`ã€`url`ï¼ˆæ–° URL éœ€ä¸åŸåè®®ä¸€è‡´ï¼Œä¸”è·¯ç”±åŒ¹é…ä»åŸºäºåŸå§‹ URLï¼‰ã€‚

#### è¿”å›å€¼
NoneTypeï¼ˆæ— è¿”å›å€¼ï¼‰

### 4. fetch() - é¢„è·å–è¯·æ±‚ç»“æœï¼ˆä¸å®Œæˆè¯·æ±‚ï¼‰
æ‰§è¡Œè¯·æ±‚å¹¶è·å–å“åº”ç»“æœï¼Œä½†ä¸å°†å“åº”è¿”å›ç»™é¡µé¢ï¼Œæ”¯æŒä¿®æ”¹å“åº”åå†é€šè¿‡ `fulfill()` å®Œæˆè¯·æ±‚ã€‚

#### ä½¿ç”¨ç¤ºä¾‹
```python
# åŒæ­¥æ¨¡å¼
def handle(route):
    response = route.fetch()
    json = response.json()
    json["message"]["big_red_dog"] = []  # ä¿®æ”¹å“åº”æ•°æ®
    route.fulfill(response=response, json=json)  # ç”¨ä¿®æ”¹åçš„å“åº”å®Œæˆè¯·æ±‚

page.route("https://dog.ceo/api/breeds/list/all", handle)

# å¼‚æ­¥æ¨¡å¼
async def handle(route):
    response = await route.fetch()
    json = await response.json()
    json["message"]["big_red_dog"] = []
    await route.fulfill(response=response, json=json)

await page.route("https://dog.ceo/api/breeds/list/all", handle)
```

#### å‚æ•°è¯´æ˜
- `headers`ï¼ˆDict[str, str]ï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚å¤´
- `max_redirects`ï¼ˆintï¼Œå¯é€‰ï¼Œv1.31+ï¼‰ï¼šæœ€å¤§è‡ªåŠ¨è·Ÿéšé‡å®šå‘æ¬¡æ•°ï¼Œé»˜è®¤ 20ï¼Œä¼  0 ä¸è·Ÿéš
- `max_retries`ï¼ˆintï¼Œå¯é€‰ï¼Œv1.46+ï¼‰ï¼šç½‘ç»œé”™è¯¯é‡è¯•æ¬¡æ•°ï¼ˆä»…é‡è¯• `ECONNRESET` é”™è¯¯ï¼‰ï¼Œé»˜è®¤ 0ï¼ˆä¸é‡è¯•ï¼‰
- `method`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚æ–¹æ³•
- `post_data`ï¼ˆstr | bytes | Dictï¼Œå¯é€‰ï¼‰ï¼šè®¾ç½® POST æ•°æ®ï¼ˆå¯¹è±¡ä¼šåºåˆ—åŒ–ä¸º JSONï¼Œé»˜è®¤ `content-type` ä¸º `application/json`ï¼›éå¯¹è±¡é»˜è®¤ `application/octet-stream`ï¼‰
- `timeout`ï¼ˆfloatï¼Œå¯é€‰ï¼Œv1.33+ï¼‰ï¼šè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé»˜è®¤ 30000ï¼ˆ30 ç§’ï¼‰ï¼Œä¼  0 ç¦ç”¨è¶…æ—¶
- `url`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šä¿®æ”¹è¯·æ±‚ URLï¼ˆéœ€ä¸åŸåè®®ä¸€è‡´ï¼‰

#### è¿”å›å€¼
APIResponseï¼ˆè¯·æ±‚å“åº”å¯¹è±¡ï¼‰

#### æ³¨æ„äº‹é¡¹
å¤´ä¿¡æ¯ï¼ˆheadersï¼‰çš„ä¿®æ”¹é€‚ç”¨äºå½“å‰è¯·æ±‚åŠåç»­é‡å®šå‘ï¼›è‹¥ä»…éœ€ä¿®æ”¹åŸå§‹è¯·æ±‚å¤´ï¼Œä½¿ç”¨ `route.continue_()`ã€‚

### 5. fulfill() - è‡ªå®šä¹‰å“åº”å®Œæˆè¯·æ±‚
ç”¨è‡ªå®šä¹‰çš„å“åº”æ•°æ®ï¼ˆçŠ¶æ€ç ã€å“åº”ä½“ã€å¤´ä¿¡æ¯ç­‰ï¼‰å®Œæˆè·¯ç”±è¯·æ±‚ï¼Œæ— éœ€å‘é€è‡³ç½‘ç»œã€‚

#### ä½¿ç”¨ç¤ºä¾‹
**è¿”å› 404 å“åº”**
```python
# åŒæ­¥æ¨¡å¼
page.route("**/*", lambda route: route.fulfill(
    status=404,
    content_type="text/plain",
    body="not found!"
))

# å¼‚æ­¥æ¨¡å¼
await page.route("**/*", lambda route: route.fulfill(
    status=404,
    content_type="text/plain",
    body="not found!"
))
```

**è¿”å›æœ¬åœ°æ–‡ä»¶ä½œä¸ºå“åº”**
```python
# åŒæ­¥æ¨¡å¼
page.route("**/xhr_endpoint", lambda route: route.fulfill(path="mock_data.json"))

# å¼‚æ­¥æ¨¡å¼
await page.route("**/xhr_endpoint", lambda route: route.fulfill(path="mock_data.json"))
```

#### å‚æ•°è¯´æ˜
- `body`ï¼ˆstr | bytesï¼Œå¯é€‰ï¼‰ï¼šå“åº”ä½“å†…å®¹
- `content_type`ï¼ˆstrï¼Œå¯é€‰ï¼‰ï¼šå“åº”çš„ `Content-Type` å¤´ï¼ˆç­‰ä»·äºè®¾ç½® headers ä¸­çš„ `Content-Type`ï¼‰
- `headers`ï¼ˆDict[str, str]ï¼Œå¯é€‰ï¼‰ï¼šå“åº”å¤´ä¿¡æ¯
- `json`ï¼ˆDictï¼Œå¯é€‰ï¼Œv1.29+ï¼‰ï¼šJSON æ ¼å¼å“åº”ä½“ï¼Œé»˜è®¤è®¾ç½® `content-type` ä¸º `application/json`
- `path`ï¼ˆUnion[str, pathlib.Path]ï¼Œå¯é€‰ï¼‰ï¼šæœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„åŸºäºå½“å‰å·¥ä½œç›®å½•ï¼‰ï¼Œä¼šè‡ªåŠ¨æ ¹æ®æ–‡ä»¶æ‰©å±•åæ¨æ–­ `content-type`
- `response`ï¼ˆAPIResponseï¼Œå¯é€‰ï¼Œv1.15+ï¼‰ï¼šåŸºäºç°æœ‰å“åº”å¯¹è±¡æ„å»ºæ–°å“åº”ï¼Œå¯é€šè¿‡å…¶ä»–å‚æ•°è¦†ç›–éƒ¨åˆ†å­—æ®µï¼ˆå¦‚å¤´ä¿¡æ¯ï¼‰
- `status`ï¼ˆintï¼Œå¯é€‰ï¼‰ï¼šå“åº”çŠ¶æ€ç ï¼Œé»˜è®¤ 200

#### è¿”å›å€¼
NoneTypeï¼ˆæ— è¿”å›å€¼ï¼‰

## äºŒã€å±æ€§
### request - è·å–å½“å‰è·¯ç”±çš„è¯·æ±‚å¯¹è±¡
è·å–è·¯ç”±å¯¹åº”çš„åŸå§‹è¯·æ±‚ä¿¡æ¯ã€‚

#### ä½¿ç”¨æ–¹å¼
```python
route.request
```

#### è¿”å›å€¼
Requestï¼ˆè¯·æ±‚å¯¹è±¡ï¼ŒåŒ…å«è¯·æ±‚ URLã€æ–¹æ³•ã€å¤´ä¿¡æ¯ç­‰è¯¦æƒ…ï¼‰