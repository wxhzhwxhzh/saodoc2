---
id: intro8
permalink: /pw/intro8
title: 'ğŸ’œroute.continue_()'
---

`route.continue_()` æ˜¯ Playwright ä¸­è·¯ç”±æ‹¦æˆªåŠŸèƒ½çš„æ ¸å¿ƒæ–¹æ³•ä¹‹ä¸€ï¼Œç”¨äºè®©è¢«æ‹¦æˆªçš„è¯·æ±‚ç»§ç»­æ­£å¸¸æ‰§è¡Œã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„ä»‹ç»ï¼š

## åŸºæœ¬æ¦‚å¿µ

å½“ä½ ä½¿ç”¨ `page.route()` æˆ– `context.route()` æ‹¦æˆªè¯·æ±‚æ—¶ï¼ŒPlaywright ä¼šæš‚åœè¯¥è¯·æ±‚ï¼Œç­‰å¾…ä½ å†³å®šå¦‚ä½•å¤„ç†ã€‚`route.continue_()` å°±æ˜¯å‘Šè¯‰ Playwrightï¼š"è¿™ä¸ªè¯·æ±‚å¯ä»¥æ­£å¸¸ç»§ç»­æ‰§è¡Œ"ã€‚

## åŸºç¡€ç”¨æ³•

### 1. ç®€å•çš„è¯·æ±‚ç»§ç»­

```python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()
    
    def handle_route(route, request):
        print(f"æ‹¦æˆªåˆ°è¯·æ±‚: {request.url}")
        # è®©è¯·æ±‚æ­£å¸¸ç»§ç»­
        route.continue_()
    
    # æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
    page.route("**/*", handle_route)
    
    page.goto("https://example.com")
    browser.close()
```

### 2. æœ‰æ¡ä»¶çš„è¯·æ±‚ç»§ç»­

```python
def handle_route(route, request):
    if "api" in request.url:
        print(f"APIè¯·æ±‚ç»§ç»­: {request.url}")
        route.continue_()
    elif "static" in request.url:
        print(f"é™æ€èµ„æºç»§ç»­: {request.url}")
        route.continue_()
    else:
        print(f"å…¶ä»–è¯·æ±‚ç»§ç»­: {request.url}")
        route.continue_()
```

## é«˜çº§ç”¨æ³• - ä¿®æ”¹è¯·æ±‚

`route.continue_()` å¯ä»¥æ¥å—å‚æ•°æ¥ä¿®æ”¹è¯·æ±‚çš„å„ä¸ªæ–¹é¢ï¼š

### 1. ä¿®æ”¹è¯·æ±‚å¤´

```python
def handle_route(route, request):
    # ä¿®æ”¹è¯·æ±‚å¤´
    headers = request.headers.copy()
    headers["User-Agent"] = "Custom Bot 1.0"
    headers["Authorization"] = "Bearer your-token-here"
    
    route.continue_(headers=headers)

page.route("**/*", handle_route)
```

### 2. ä¿®æ”¹è¯·æ±‚æ–¹æ³•

```python
def handle_route(route, request):
    if request.method == "GET" and "/api/data" in request.url:
        # å°†GETè¯·æ±‚æ”¹ä¸ºPOST
        route.continue_(method="POST")
    else:
        route.continue_()

page.route("**/api/**", handle_route)
```

### 3. ä¿®æ”¹URL

```python
def handle_route(route, request):
    original_url = request.url
    
    # å°†è¯·æ±‚é‡å®šå‘åˆ°æµ‹è¯•ç¯å¢ƒ
    if "production.example.com" in original_url:
        new_url = original_url.replace("production.example.com", "staging.example.com")
        print(f"é‡å®šå‘: {original_url} -> {new_url}")
        route.continue_(url=new_url)
    else:
        route.continue_()

page.route("**/*", handle_route)
```

### 4. ä¿®æ”¹POSTæ•°æ®

```python
import json

def handle_route(route, request):
    if request.method == "POST" and "/api/login" in request.url:
        # è·å–åŸå§‹POSTæ•°æ®
        try:
            original_data = json.loads(request.post_data or "{}")
            # ä¿®æ”¹æ•°æ®
            original_data["test_flag"] = True
            original_data["environment"] = "testing"
            
            new_post_data = json.dumps(original_data)
            
            route.continue_(
                post_data=new_post_data,
                headers={**request.headers, "Content-Type": "application/json"}
            )
        except (json.JSONDecodeError, TypeError):
            # å¦‚æœä¸æ˜¯JSONæ•°æ®ï¼Œæ­£å¸¸ç»§ç»­
            route.continue_()
    else:
        route.continue_()

page.route("**/api/**", handle_route)
```

## å®Œæ•´çš„å‚æ•°åˆ—è¡¨

`route.continue_()` æ”¯æŒä»¥ä¸‹å‚æ•°ï¼š

```python
def handle_route(route, request):
    route.continue_(
        url="https://new-url.com",           # æ–°çš„URL
        method="POST",                       # æ–°çš„HTTPæ–¹æ³•
        headers={"Custom": "Header"},        # æ–°çš„è¯·æ±‚å¤´
        post_data="new post data",           # æ–°çš„POSTæ•°æ®
        post_data_buffer=b"binary data"      # äºŒè¿›åˆ¶POSTæ•°æ®
    )
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. APIæµ‹è¯•ç¯å¢ƒåˆ‡æ¢

```python
class EnvironmentSwitcher:
    def __init__(self, target_env="staging"):
        self.target_env = target_env
        self.env_mapping = {
            "production": "prod.api.example.com",
            "staging": "staging.api.example.com",
            "development": "dev.api.example.com"
        }
    
    def handle_route(self, route, request):
        url = request.url
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯APIè¯·æ±‚
        if "/api/" in url:
            for env, domain in self.env_mapping.items():
                if domain in url and env != self.target_env:
                    new_url = url.replace(domain, self.env_mapping[self.target_env])
                    print(f"ç¯å¢ƒåˆ‡æ¢: {url} -> {new_url}")
                    route.continue_(url=new_url)
                    return
        
        route.continue_()

# ä½¿ç”¨ç¤ºä¾‹
with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()
    
    switcher = EnvironmentSwitcher("staging")
    page.route("**/*", switcher.handle_route)
    
    page.goto("https://app.example.com")
    browser.close()
```

### 2. è¯·æ±‚æ—¥å¿—è®°å½•

```python
import time
from datetime import datetime

class RequestLogger:
    def __init__(self):
        self.requests = []
    
    def handle_route(self, route, request):
        start_time = time.time()
        
        # è®°å½•è¯·æ±‚ä¿¡æ¯
        request_info = {
            "url": request.url,
            "method": request.method,
            "headers": dict(request.headers),
            "timestamp": datetime.now().isoformat(),
            "start_time": start_time
        }
        
        # ç»§ç»­è¯·æ±‚
        route.continue_()
        
        # è®°å½•åˆ°åˆ—è¡¨ä¸­
        self.requests.append(request_info)
        print(f"[{request_info['timestamp']}] {request.method} {request.url}")
    
    def get_summary(self):
        return {
            "total_requests": len(self.requests),
            "methods": [req["method"] for req in self.requests],
            "domains": list(set([req["url"].split("/")[2] for req in self.requests if len(req["url"].split("/")) > 2]))
        }

# ä½¿ç”¨ç¤ºä¾‹
logger = RequestLogger()

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()
    
    page.route("**/*", logger.handle_route)
    
    page.goto("https://example.com")
    page.click("a[href='/about']")
    
    print("\nè¯·æ±‚æ‘˜è¦:", logger.get_summary())
    browser.close()
```

### 3. è¯·æ±‚é‡è¯•æœºåˆ¶

```python
import time

class RetryHandler:
    def __init__(self, max_retries=3):
        self.max_retries = max_retries
        self.retry_count = {}
    
    def handle_route(self, route, request):
        url = request.url
        
        # ä¸ºæ¯ä¸ªURLç»´æŠ¤é‡è¯•è®¡æ•°
        if url not in self.retry_count:
            self.retry_count[url] = 0
        
        try:
            # å°è¯•ç»§ç»­è¯·æ±‚
            route.continue_()
        except Exception as e:
            # å¦‚æœè¯·æ±‚å¤±è´¥ä¸”æœªè¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°
            if self.retry_count[url] < self.max_retries:
                self.retry_count[url] += 1
                print(f"è¯·æ±‚å¤±è´¥ï¼Œé‡è¯• {self.retry_count[url]}/{self.max_retries}: {url}")
                time.sleep(1)  # ç­‰å¾…1ç§’åé‡è¯•
                route.continue_()
            else:
                print(f"è¯·æ±‚æœ€ç»ˆå¤±è´¥: {url}")
                route.abort()

# ä½¿ç”¨ç¤ºä¾‹
retry_handler = RetryHandler(max_retries=2)

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()
    
    page.route("**/*", retry_handler.handle_route)
    
    page.goto("https://example.com")
    browser.close()
```

### 4. ç¼“å­˜æ§åˆ¶

```python
class CacheController:
    def __init__(self, cache_policy="no-cache"):
        self.cache_policy = cache_policy
    
    def handle_route(self, route, request):
        headers = request.headers.copy()
        
        if self.cache_policy == "no-cache":
            headers["Cache-Control"] = "no-cache, no-store, must-revalidate"
            headers["Pragma"] = "no-cache"
            headers["Expires"] = "0"
        elif self.cache_policy == "max-cache":
            headers["Cache-Control"] = "max-age=31536000"
        
        route.continue_(headers=headers)

# ä½¿ç”¨ç¤ºä¾‹
cache_controller = CacheController("no-cache")

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()
    
    page.route("**/*", cache_controller.handle_route)
    
    page.goto("https://example.com")
    browser.close()
```

## é”™è¯¯å¤„ç†

```python
def safe_continue(route, request):
    try:
        # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æœ‰æ•ˆ
        if not request.url or request.url == "about:blank":
            route.abort()
            return
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯æ”¯æŒçš„æ–¹æ³•
        if request.method not in ["GET", "POST", "PUT", "DELETE", "PATCH"]:
            print(f"ä¸æ”¯æŒçš„HTTPæ–¹æ³•: {request.method}")
            route.abort()
            return
        
        # æ­£å¸¸ç»§ç»­
        route.continue_()
        
    except Exception as e:
        print(f"å¤„ç†è¯·æ±‚æ—¶å‡ºé”™: {e}")
        # å¦‚æœä¿®æ”¹è¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä¸ä¿®æ”¹ç›´æ¥ç»§ç»­
        try:
            route.continue_()
        except:
            # æœ€åçš„é€‰æ‹©ï¼šä¸­æ­¢è¯·æ±‚
            route.abort()

page.route("**/*", safe_continue)
```

## æ€§èƒ½è€ƒè™‘

```python
import fnmatch

class OptimizedRouter:
    def __init__(self):
        # é¢„ç¼–è¯‘çš„æ¨¡å¼åŒ¹é…
        self.static_patterns = ["*.css", "*.js", "*.png", "*.jpg", "*.gif"]
        self.api_patterns = ["/api/*", "/graphql*"]
    
    def handle_route(self, route, request):
        url = request.url
        
        # å¿«é€Ÿæ£€æŸ¥é™æ€èµ„æº
        if any(fnmatch.fnmatch(url, pattern) for pattern in self.static_patterns):
            # é™æ€èµ„æºç›´æ¥ç»§ç»­ï¼Œä¸åšé¢å¤–å¤„ç†
            route.continue_()
            return
        
        # APIè¯·æ±‚å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†
        if any(fnmatch.fnmatch(url, pattern) for pattern in self.api_patterns):
            self._handle_api_request(route, request)
        else:
            route.continue_()
    
    def _handle_api_request(self, route, request):
        # APIç‰¹å®šçš„å¤„ç†é€»è¾‘
        headers = request.headers.copy()
        headers["X-Test-Mode"] = "true"
        route.continue_(headers=headers)

# ä½¿ç”¨ç¤ºä¾‹
router = OptimizedRouter()
page.route("**/*", router.handle_route)
```

## è°ƒè¯•æŠ€å·§

```python
import json

def debug_route(route, request):
    print(f"\n=== è¯·æ±‚è°ƒè¯•ä¿¡æ¯ ===")
    print(f"URL: {request.url}")
    print(f"æ–¹æ³•: {request.method}")
    print(f"å¤´éƒ¨: {json.dumps(dict(request.headers), indent=2)}")
    
    if request.post_data:
        print(f"POSTæ•°æ®: {request.post_data[:200]}...")  # åªæ˜¾ç¤ºå‰200å­—ç¬¦
    
    print(f"èµ„æºç±»å‹: {request.resource_type}")
    print(f"æ˜¯å¦å¯¼èˆª: {request.is_navigation_request()}")
    print("===================\n")
    
    # ç»§ç»­è¯·æ±‚
    route.continue_()

page.route("**/*", debug_route)
```

## æ³¨æ„äº‹é¡¹

1. **å¿…é¡»è°ƒç”¨å¤„ç†æ–¹æ³•**ï¼šæ¯ä¸ªè¢«æ‹¦æˆªçš„è¯·æ±‚éƒ½å¿…é¡»è°ƒç”¨ `continue_()`ã€`fulfill()` æˆ– `abort()` ä¸­çš„ä¸€ä¸ª
2. **åªèƒ½è°ƒç”¨ä¸€æ¬¡**ï¼šæ¯ä¸ª route å¯¹è±¡åªèƒ½è°ƒç”¨ä¸€æ¬¡å¤„ç†æ–¹æ³•
3. **å¼‚æ­¥å¤„ç†**ï¼šåœ¨å¼‚æ­¥ç¯å¢ƒä¸­ä½¿ç”¨æ—¶è¦æ³¨æ„ await
4. **æ€§èƒ½å½±å“**ï¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚å¯èƒ½å½±å“æ€§èƒ½ï¼Œå»ºè®®ä½¿ç”¨å…·ä½“çš„URLæ¨¡å¼
5. **é”™è¯¯å¤„ç†**ï¼šè¦å¦¥å–„å¤„ç†å¯èƒ½çš„å¼‚å¸¸æƒ…å†µ

é€šè¿‡çµæ´»ä½¿ç”¨ `route.continue_()`ï¼Œä½ å¯ä»¥å®ç°å¼ºå¤§çš„è¯·æ±‚æ‹¦æˆªå’Œä¿®æ”¹åŠŸèƒ½ï¼Œè¿™å¯¹äºæµ‹è¯•ã€è°ƒè¯•å’Œæ¨¡æ‹Ÿä¸åŒç¯å¢ƒéå¸¸æœ‰ç”¨ã€‚