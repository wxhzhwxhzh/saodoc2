---
id: intro6
permalink: /pw/intro6
title: 'ğŸ’œsync_playwright'
---

# Python ä¸­ `sync_playwright` ä½¿ç”¨è¯¦è§£

`sync_playwright` æ˜¯ [Playwright](https://playwright.dev/python/)
æä¾›çš„åŒæ­¥ API æ¥å£ï¼Œ\
å®ƒå…è®¸æˆ‘ä»¬ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™æµè§ˆå™¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œè€Œä¸ç”¨å¤„ç†å¼‚æ­¥ `async/await`
è¯­æ³•ï¼Œ\
éå¸¸é€‚åˆå¿«é€Ÿä¸Šæ‰‹å’Œç¼–å†™è„šæœ¬ã€‚

------------------------------------------------------------------------

## 1. å®‰è£… Playwright

``` bash
pip install playwright
# å®‰è£…æµè§ˆå™¨é©±åŠ¨
playwright install
```

------------------------------------------------------------------------

## 2. å¼•å…¥ `sync_playwright`

``` python
from playwright.sync_api import sync_playwright
```

> `sync_playwright` æ˜¯ Playwright çš„å…¥å£ï¼Œ\
> éœ€è¦é€šè¿‡ `with` ä¸Šä¸‹æ–‡æ¥å¯åŠ¨å’Œå…³é—­ Playwrightã€‚

------------------------------------------------------------------------

## 3. åŸºæœ¬ä½¿ç”¨

``` python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    # å¯åŠ¨æµè§ˆå™¨ (chromium / firefox / webkit)
    browser = p.chromium.launch(headless=False)  
    page = browser.new_page()
    
    # æ‰“å¼€ç½‘é¡µ
    page.goto("https://example.com")
    
    # è·å–é¡µé¢æ ‡é¢˜
    print(page.title())
    
    # æˆªå›¾
    page.screenshot(path="example.png")
    
    # å…³é—­æµè§ˆå™¨
    browser.close()
```

------------------------------------------------------------------------

## 4. æµè§ˆå™¨æ“ä½œ

### 4.1 å¯åŠ¨æµè§ˆå™¨

``` python
# æ— å¤´æ¨¡å¼ (é»˜è®¤ True)
browser = p.chromium.launch(headless=True)

# æ˜¾ç¤ºæµè§ˆå™¨çª—å£
browser = p.chromium.launch(headless=False)

# è°ƒè¯•æ¨¡å¼ (slow_mo æ¯æ­¥æ“ä½œå»¶è¿Ÿ 500ms)
browser = p.chromium.launch(headless=False, slow_mo=500)

# æŒ‡å®šç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆä¿å­˜ç™»å½•çŠ¶æ€ç­‰ï¼‰
browser = p.chromium.launch_persistent_context(
    user_data_dir="userdata",
    headless=False
)
```

------------------------------------------------------------------------

### 4.2 æ–°å»ºé¡µé¢

``` python
context = browser.new_context()
page = context.new_page()
```

ä¸€ä¸ª **Browser** å¯ä»¥åŒ…å«å¤šä¸ª **Context**ï¼Œæ¯ä¸ª **Context**
å°±åƒä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆå™¨å®ä¾‹ï¼Œäº’ä¸å¹²æ‰°ã€‚

------------------------------------------------------------------------

## 5. é¡µé¢å¸¸ç”¨æ“ä½œ

### 5.1 æ‰“å¼€é¡µé¢

``` python
page.goto("https://www.baidu.com")
```

### 5.2 è¾“å…¥å†…å®¹

``` python
page.fill("input[name='wd']", "Playwright Python")
```

### 5.3 ç‚¹å‡»æŒ‰é’®

``` python
page.click("input[type='submit']")
```

### 5.4 è·å–å…ƒç´ æ–‡æœ¬

``` python
text = page.inner_text("h1")
print(text)
```

### 5.5 è·å–å±æ€§

``` python
href = page.get_attribute("a", "href")
print(href)
```

### 5.6 ç­‰å¾…å…ƒç´ åŠ è½½

``` python
page.wait_for_selector("#result")
```

------------------------------------------------------------------------

## 6. é¡µé¢æˆªå›¾ä¸ PDF

``` python
# æˆªå›¾
page.screenshot(path="page.png", full_page=True)

# å¯¼å‡º PDF (ä»…æ”¯æŒ Chromium)
page.pdf(path="page.pdf", format="A4")
```

------------------------------------------------------------------------

## 7. æ‰§è¡Œ JavaScript

``` python
result = page.evaluate("() => document.title")
print(result)
```

å¯ä»¥ä¼ å‚ï¼š

``` python
result = page.evaluate("(x, y) => x + y", 5, 7)
print(result)  # 12
```

------------------------------------------------------------------------

## 8. å¤„ç†å¼¹çª— (Dialog)

``` python
def handle_dialog(dialog):
    print(dialog.message)
    dialog.accept()

page.on("dialog", handle_dialog)
page.click("#alertButton")
```

------------------------------------------------------------------------

## 9. ç½‘ç»œè¯·æ±‚æ‹¦æˆªä¸ä¿®æ”¹

``` python
def handle_route(route, request):
    if "api" in request.url:
        print("æ‹¦æˆªåˆ°è¯·æ±‚:", request.url)
        route.abort()
    else:
        route.continue_()

page.route("**/*", handle_route)
page.goto("https://example.com")
```

------------------------------------------------------------------------

## 10. æ–‡ä»¶ä¸Šä¼ ä¸ä¸‹è½½

### ä¸Šä¼ æ–‡ä»¶

``` python
page.set_input_files("input[type='file']", "example.txt")
```

### æ–‡ä»¶ä¸‹è½½

``` python
with page.expect_download() as download_info:
    page.click("a#download")
download = download_info.value
download.save_as("downloaded_file.txt")
```

------------------------------------------------------------------------

## 11. è‡ªåŠ¨ç­‰å¾…æœºåˆ¶

Playwright å†…ç½®æ™ºèƒ½ç­‰å¾…ï¼Œä¸éœ€è¦é¢‘ç¹ `sleep`ã€‚\
å¸¸è§ç­‰å¾…æ–¹æ³•ï¼š

-   `page.wait_for_selector("css")`
-   `page.wait_for_timeout(2000)` \# å¼ºåˆ¶ç­‰å¾… 2 ç§’
-   `page.wait_for_load_state("networkidle")`

------------------------------------------------------------------------

## 12. ç¤ºä¾‹ï¼šç™¾åº¦æœç´¢å¹¶æˆªå›¾

``` python
from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    page = browser.new_page()
    
    page.goto("https://www.baidu.com")
    page.fill("input[name='wd']", "Playwright Python")
    page.press("input[name='wd']", "Enter")
    
    page.wait_for_selector("#content_left")
    page.screenshot(path="baidu_result.png", full_page=True)
    
    browser.close()
```

------------------------------------------------------------------------

## 13. æ€»ç»“

-   `sync_playwright` é€‚åˆå¿«é€Ÿç¼–å†™åŒæ­¥è„šæœ¬ï¼Œç®€å•æ˜“ç”¨ã€‚
-   æä¾›äº†å¼ºå¤§çš„ **é¡µé¢æ“ä½œ
    API**ï¼ŒåŒ…æ‹¬å…ƒç´ äº¤äº’ã€æˆªå›¾ã€PDFã€ä¸‹è½½ã€ä¸Šä¼ ç­‰ã€‚
-   å†…ç½® **æ™ºèƒ½ç­‰å¾…æœºåˆ¶**ï¼Œå¤§å¤§å‡å°‘æ‰‹åŠ¨ `sleep` çš„éœ€è¦ã€‚
-   å¯ç”¨äº **çˆ¬è™«ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€é€†å‘åˆ†æ** ç­‰åœºæ™¯ã€‚

------------------------------------------------------------------------

ğŸ“Œ **å®˜æ–¹æ–‡æ¡£**: [Playwright for
Python](https://playwright.dev/python/docs/intro)
